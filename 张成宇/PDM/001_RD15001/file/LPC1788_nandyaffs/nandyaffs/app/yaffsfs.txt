; generated by Component: ARM Compiler 5.04 update 1 (build 49) Tool: ArmCC [5040049]
; commandline ArmCC [--list --debug -c --asm --interleave -o.\flash\yaffsfs.o --asm_dir=.\ --list_dir=.\ --depend=.\flash\yaffsfs.d --feedback=.\Flash\YL_LPC1788_Test.fed --cpu=Cortex-M3 --apcs=interwork -O0 -I..\app -I..\CM3_lib -I..\Drivers -I..\Startup -I.\Easy_web -I.\Lcd_Drv -I.\IIC_Test -I.\USU_Host -I.\Nand_Test -I.\FATFS_R0.08 -I..\fs -I"D:\Program Files\mdk\ARM\RV31\INC" -I"D:\Program Files\mdk\pack\ARM\CMSIS\4.1.1\CMSIS\Include" -I"D:\Program Files\mdk\ARM\Inc\NXP\LPC177x_8x" -D__MICROLIB --omf_browse=.\flash\yaffsfs.crf ..\fs\yaffsfs.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  yaffsfs_InitHandles PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  2100              MOVS     r1,#0
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  e012              B        |L1.42|
                  |L1.4|
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  eb010041          ADD      r0,r1,r1,LSL #1
000008  4afe              LDR      r2,|L1.1028|
00000a  f8120020          LDRB     r0,[r2,r0,LSL #2]
00000e  f0200001          BIC      r0,r0,#1
000012  eb010241          ADD      r2,r1,r1,LSL #1
000016  4bfb              LDR      r3,|L1.1028|
000018  f8030022          STRB     r0,[r3,r2,LSL #2]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  2000              MOVS     r0,#0
00001e  eb010241          ADD      r2,r1,r1,LSL #1
000022  eb030282          ADD      r2,r3,r2,LSL #2
000026  6090              STR      r0,[r2,#8]
000028  1c49              ADDS     r1,r1,#1              ;64
                  |L1.42|
00002a  29c8              CMP      r1,#0xc8              ;64
00002c  dbea              BLT      |L1.4|
;;;68     	}
;;;69     	return 0;
00002e  2000              MOVS     r0,#0
;;;70     }
000030  4770              BX       lr
;;;71     
                          ENDP

                  yaffsfs_GetHandlePointer PROC
;;;72     yaffsfs_Handle *yaffsfs_GetHandlePointer(int h)
000032  4601              MOV      r1,r0
;;;73     {
;;;74     	if(h < 0 || h >= YAFFSFS_N_HANDLES)
000034  2900              CMP      r1,#0
000036  db01              BLT      |L1.60|
000038  29c8              CMP      r1,#0xc8
00003a  db01              BLT      |L1.64|
                  |L1.60|
;;;75     	{
;;;76     		return NULL;
00003c  2000              MOVS     r0,#0
                  |L1.62|
;;;77     	}
;;;78     
;;;79     	return &yaffsfs_handle[h];
;;;80     }
00003e  4770              BX       lr
                  |L1.64|
000040  eb010041          ADD      r0,r1,r1,LSL #1       ;79
000044  4aef              LDR      r2,|L1.1028|
000046  eb020080          ADD      r0,r2,r0,LSL #2       ;79
00004a  e7f8              B        |L1.62|
;;;81     
                          ENDP

                  yaffsfs_GetHandleObject PROC
;;;82     yaffs_Object *yaffsfs_GetHandleObject(int handle)
00004c  b510              PUSH     {r4,lr}
;;;83     {
00004e  4604              MOV      r4,r0
;;;84     	yaffsfs_Handle *h = yaffsfs_GetHandlePointer(handle);
000050  4620              MOV      r0,r4
000052  f7fffffe          BL       yaffsfs_GetHandlePointer
000056  4603              MOV      r3,r0
;;;85     
;;;86     	if(h && h->inUse)
000058  b12b              CBZ      r3,|L1.102|
00005a  7818              LDRB     r0,[r3,#0]
00005c  f0000001          AND      r0,r0,#1
000060  b108              CBZ      r0,|L1.102|
;;;87     	{
;;;88     		return h->obj;
000062  6898              LDR      r0,[r3,#8]
                  |L1.100|
;;;89     	}
;;;90     
;;;91     	return NULL;
;;;92     }
000064  bd10              POP      {r4,pc}
                  |L1.102|
000066  2000              MOVS     r0,#0                 ;91
000068  e7fc              B        |L1.100|
;;;93     
                          ENDP

                  yaffsfs_GetHandle PROC
;;;98     
;;;99     static int yaffsfs_GetHandle(void)
00006a  b510              PUSH     {r4,lr}
;;;100    {
;;;101    	int i;
;;;102    	yaffsfs_Handle *h;
;;;103    
;;;104    	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
00006c  2400              MOVS     r4,#0
00006e  e013              B        |L1.152|
                  |L1.112|
;;;105    	{
;;;106    		h = yaffsfs_GetHandlePointer(i);
000070  4620              MOV      r0,r4
000072  f7fffffe          BL       yaffsfs_GetHandlePointer
000076  4603              MOV      r3,r0
;;;107    		if(!h)
;;;108    		{
;;;109    			// todo bug: should never happen
;;;110    		}
;;;111    		if(!h->inUse)
000078  7818              LDRB     r0,[r3,#0]
00007a  f0000001          AND      r0,r0,#1
00007e  b950              CBNZ     r0,|L1.150|
;;;112    		{
;;;113    			memset(h,0,sizeof(yaffsfs_Handle));
000080  2000              MOVS     r0,#0
000082  6018              STR      r0,[r3,#0]
000084  6058              STR      r0,[r3,#4]
000086  6098              STR      r0,[r3,#8]
;;;114    			h->inUse=1;
000088  7818              LDRB     r0,[r3,#0]
00008a  f0200001          BIC      r0,r0,#1
00008e  1c40              ADDS     r0,r0,#1
000090  7018              STRB     r0,[r3,#0]
;;;115    			return i;
000092  4620              MOV      r0,r4
                  |L1.148|
;;;116    		}
;;;117    	}
;;;118    	return -1;
;;;119    }
000094  bd10              POP      {r4,pc}
                  |L1.150|
000096  1c64              ADDS     r4,r4,#1              ;104
                  |L1.152|
000098  2cc8              CMP      r4,#0xc8              ;104
00009a  dbe9              BLT      |L1.112|
00009c  f04f30ff          MOV      r0,#0xffffffff        ;118
0000a0  e7f8              B        |L1.148|
;;;120    
                          ENDP

                  yaffsfs_PutHandle PROC
;;;123    //
;;;124    static int yaffsfs_PutHandle(int handle)
0000a2  b510              PUSH     {r4,lr}
;;;125    {
0000a4  4604              MOV      r4,r0
;;;126    	yaffsfs_Handle *h = yaffsfs_GetHandlePointer(handle);
0000a6  4620              MOV      r0,r4
0000a8  f7fffffe          BL       yaffsfs_GetHandlePointer
0000ac  4603              MOV      r3,r0
;;;127    
;;;128    	if(h)
0000ae  b12b              CBZ      r3,|L1.188|
;;;129    	{
;;;130    		h->inUse = 0;
0000b0  7818              LDRB     r0,[r3,#0]
0000b2  f0200001          BIC      r0,r0,#1
0000b6  7018              STRB     r0,[r3,#0]
;;;131    		h->obj = NULL;
0000b8  2000              MOVS     r0,#0
0000ba  6098              STR      r0,[r3,#8]
                  |L1.188|
;;;132    	}
;;;133    	return 0;
0000bc  2000              MOVS     r0,#0
;;;134    }
0000be  bd10              POP      {r4,pc}
;;;135    
                          ENDP

                  yaffsfs_Match PROC
;;;140    
;;;141    int yaffsfs_Match(YCHAR a, YCHAR b)
0000c0  4602              MOV      r2,r0
;;;142    {
;;;143    	// case sensitive
;;;144    	return (a == b);
0000c2  428a              CMP      r2,r1
0000c4  d101              BNE      |L1.202|
0000c6  2001              MOVS     r0,#1
                  |L1.200|
;;;145    }
0000c8  4770              BX       lr
                  |L1.202|
0000ca  2000              MOVS     r0,#0                 ;144
0000cc  e7fc              B        |L1.200|
;;;146    
                          ENDP

                  yaffsfs_IsPathDivider PROC
;;;147    int yaffsfs_IsPathDivider(YCHAR ch)
0000ce  4602              MOV      r2,r0
;;;148    {
;;;149    	YCHAR *str = YAFFS_PATH_DIVIDERS;
0000d0  a1cd              ADR      r1,|L1.1032|
;;;150    
;;;151    	while(*str){
0000d2  e005              B        |L1.224|
                  |L1.212|
;;;152    		if(*str == ch)
0000d4  7808              LDRB     r0,[r1,#0]
0000d6  4290              CMP      r0,r2
0000d8  d101              BNE      |L1.222|
;;;153    			return 1;
0000da  2001              MOVS     r0,#1
                  |L1.220|
;;;154    		str++;
;;;155    	}
;;;156    
;;;157    	return 0;
;;;158    }
0000dc  4770              BX       lr
                  |L1.222|
0000de  1c49              ADDS     r1,r1,#1              ;154
                  |L1.224|
0000e0  7808              LDRB     r0,[r1,#0]            ;151
0000e2  2800              CMP      r0,#0                 ;151
0000e4  d1f6              BNE      |L1.212|
0000e6  bf00              NOP                            ;157
0000e8  e7f8              B        |L1.220|
;;;159    
                          ENDP

                  yaffsfs_FindDevice PROC
;;;164    // Curveball2 Might have "/x/ and "/x/y". Need to return the longest match
;;;165    static yaffs_Device *yaffsfs_FindDevice(const YCHAR *path, YCHAR **restOfPath)
0000ea  e92d4ff0          PUSH     {r4-r11,lr}
;;;166    {
0000ee  4680              MOV      r8,r0
0000f0  4689              MOV      r9,r1
;;;167    	yaffsfs_DeviceConfiguration *cfg = yaffsfs_configurationList;
0000f2  48c6              LDR      r0,|L1.1036|
0000f4  6805              LDR      r5,[r0,#0]  ; yaffsfs_configurationList
;;;168    	const YCHAR *leftOver;
;;;169    	const YCHAR *p;
;;;170    	yaffs_Device *retval = NULL;
0000f6  f04f0a00          MOV      r10,#0
;;;171    	int thisMatchLength;
;;;172    	int longestMatch = -1;
0000fa  f04f3bff          MOV      r11,#0xffffffff
;;;173    	int matching;
;;;174    
;;;175    	// Check all configs, choose the one that:
;;;176    	// 1) Actually matches a prefix (ie /a amd /abc will not match
;;;177    	// 2) Matches the longest.
;;;178    	while(cfg && cfg->prefix && cfg->dev)
0000fe  e041              B        |L1.388|
                  |L1.256|
;;;179    	{
;;;180    		leftOver = path;
000100  4643              MOV      r3,r8
;;;181    		p = cfg->prefix;
000102  682c              LDR      r4,[r5,#0]
;;;182    		thisMatchLength = 0;
000104  2600              MOVS     r6,#0
;;;183    		matching = 1;
000106  2701              MOVS     r7,#1
;;;184    
;;;185    
;;;186    		while(matching && *p && *leftOver){
000108  e026              B        |L1.344|
                  |L1.266|
;;;187    			// Skip over any /s
;;;188    			while(yaffsfs_IsPathDivider(*p))
00010a  e000              B        |L1.270|
                  |L1.268|
;;;189    			      p++;
00010c  1c64              ADDS     r4,r4,#1
                  |L1.270|
00010e  7820              LDRB     r0,[r4,#0]            ;188
000110  f7fffffe          BL       yaffsfs_IsPathDivider
000114  2800              CMP      r0,#0                 ;188
000116  d1f9              BNE      |L1.268|
;;;190    
;;;191    			// Skip over any /s
;;;192    			while(yaffsfs_IsPathDivider(*leftOver))
000118  e000              B        |L1.284|
                  |L1.282|
;;;193    		              leftOver++;
00011a  1c5b              ADDS     r3,r3,#1
                  |L1.284|
00011c  7818              LDRB     r0,[r3,#0]            ;192
00011e  f7fffffe          BL       yaffsfs_IsPathDivider
000122  2800              CMP      r0,#0                 ;192
000124  d1f9              BNE      |L1.282|
;;;194    
;;;195    			// Now match the text part
;;;196    		        while(matching &&
000126  e009              B        |L1.316|
                  |L1.296|
;;;197    		              *p && !yaffsfs_IsPathDivider(*p) &&
;;;198    		              *leftOver && !yaffsfs_IsPathDivider(*leftOver)){
;;;199    			      	if(yaffsfs_Match(*p,*leftOver)){
000128  7819              LDRB     r1,[r3,#0]
00012a  7820              LDRB     r0,[r4,#0]
00012c  f7fffffe          BL       yaffsfs_Match
000130  b118              CBZ      r0,|L1.314|
;;;200    			      		p++;
000132  1c64              ADDS     r4,r4,#1
;;;201    			      		leftOver++;
000134  1c5b              ADDS     r3,r3,#1
;;;202    			      		thisMatchLength++;
000136  1c76              ADDS     r6,r6,#1
000138  e000              B        |L1.316|
                  |L1.314|
;;;203    				} else {
;;;204    					matching = 0;
00013a  2700              MOVS     r7,#0
                  |L1.316|
00013c  b167              CBZ      r7,|L1.344|
00013e  7820              LDRB     r0,[r4,#0]            ;197
000140  b150              CBZ      r0,|L1.344|
000142  7820              LDRB     r0,[r4,#0]            ;197
000144  f7fffffe          BL       yaffsfs_IsPathDivider
000148  b930              CBNZ     r0,|L1.344|
00014a  7818              LDRB     r0,[r3,#0]            ;198
00014c  b120              CBZ      r0,|L1.344|
00014e  7818              LDRB     r0,[r3,#0]            ;198
000150  f7fffffe          BL       yaffsfs_IsPathDivider
000154  2800              CMP      r0,#0                 ;198
000156  d0e7              BEQ      |L1.296|
                  |L1.344|
000158  b127              CBZ      r7,|L1.356|
00015a  7820              LDRB     r0,[r4,#0]            ;186
00015c  b110              CBZ      r0,|L1.356|
00015e  7818              LDRB     r0,[r3,#0]            ;186
000160  2800              CMP      r0,#0                 ;186
000162  d1d2              BNE      |L1.266|
                  |L1.356|
;;;205    				}
;;;206    			}
;;;207    		}
;;;208    
;;;209    		// Skip over any /s in leftOver
;;;210    		while(yaffsfs_IsPathDivider(*leftOver))
000164  e000              B        |L1.360|
                  |L1.358|
;;;211    	              leftOver++;
000166  1c5b              ADDS     r3,r3,#1
                  |L1.360|
000168  7818              LDRB     r0,[r3,#0]            ;210
00016a  f7fffffe          BL       yaffsfs_IsPathDivider
00016e  2800              CMP      r0,#0                 ;210
000170  d1f9              BNE      |L1.358|
;;;212    		
;;;213    
;;;214    		if( matching && (thisMatchLength > longestMatch))
000172  b137              CBZ      r7,|L1.386|
000174  455e              CMP      r6,r11
000176  dd04              BLE      |L1.386|
;;;215    		{
;;;216    			// Matched prefix
;;;217    			*restOfPath = (YCHAR *)leftOver;
000178  f8c93000          STR      r3,[r9,#0]
;;;218    			retval = cfg->dev;
00017c  f8d5a004          LDR      r10,[r5,#4]
;;;219    			longestMatch = thisMatchLength;
000180  46b3              MOV      r11,r6
                  |L1.386|
;;;220    		}
;;;221    
;;;222    		cfg++;
000182  3508              ADDS     r5,r5,#8
                  |L1.388|
000184  b125              CBZ      r5,|L1.400|
000186  6828              LDR      r0,[r5,#0]            ;178
000188  b110              CBZ      r0,|L1.400|
00018a  6868              LDR      r0,[r5,#4]            ;178
00018c  2800              CMP      r0,#0                 ;178
00018e  d1b7              BNE      |L1.256|
                  |L1.400|
;;;223    	}
;;;224    	return retval;
000190  4650              MOV      r0,r10
;;;225    }
000192  e8bd8ff0          POP      {r4-r11,pc}
;;;226    
                          ENDP

                  yaffsfs_FindRoot PROC
;;;271    
;;;272    static yaffs_Object *yaffsfs_FindRoot(const YCHAR *path, YCHAR **restOfPath)
000196  b570              PUSH     {r4-r6,lr}
;;;273    {
000198  4605              MOV      r5,r0
00019a  460e              MOV      r6,r1
;;;274    
;;;275    	yaffs_Device *dev;
;;;276    
;;;277    	dev= yaffsfs_FindDevice(path,restOfPath);
00019c  4631              MOV      r1,r6
00019e  4628              MOV      r0,r5
0001a0  f7fffffe          BL       yaffsfs_FindDevice
0001a4  4604              MOV      r4,r0
;;;278    	if(dev && dev->isMounted)
0001a6  b12c              CBZ      r4,|L1.436|
0001a8  f8d40094          LDR      r0,[r4,#0x94]
0001ac  b110              CBZ      r0,|L1.436|
;;;279    	{
;;;280    		return dev->rootDir;
0001ae  f8d40d84          LDR      r0,[r4,#0xd84]
                  |L1.434|
;;;281    	}
;;;282    	return NULL;
;;;283    }
0001b2  bd70              POP      {r4-r6,pc}
                  |L1.436|
0001b4  2000              MOVS     r0,#0                 ;282
0001b6  e7fc              B        |L1.434|
;;;284    
                          ENDP

                  yaffsfs_DoFindDirectory PROC
;;;310    // eg. "/data/xx/ff" --> puts name="ff" and returns the directory "/data/xx"
;;;311    static yaffs_Object *yaffsfs_DoFindDirectory(yaffs_Object *startDir,const YCHAR *path,YCHAR **name,int symDepth)
0001b8  e92d43f0          PUSH     {r4-r9,lr}
;;;312    {
0001bc  b0c1              SUB      sp,sp,#0x104
0001be  4606              MOV      r6,r0
0001c0  460f              MOV      r7,r1
0001c2  4691              MOV      r9,r2
0001c4  4698              MOV      r8,r3
;;;313    	yaffs_Object *dir;
;;;314    	YCHAR *restOfPath;
;;;315    	YCHAR str[YAFFS_MAX_NAME_LENGTH+1];
;;;316    	int i;
;;;317    
;;;318    	if(symDepth > YAFFSFS_MAX_SYMLINK_DEREFERENCES)
0001c6  f1b80f05          CMP      r8,#5
0001ca  dd03              BLE      |L1.468|
;;;319    	{
;;;320    		return NULL;
0001cc  2000              MOVS     r0,#0
                  |L1.462|
;;;321    	}
;;;322    
;;;323    	if(startDir)
;;;324    	{
;;;325    		dir = startDir;
;;;326    		restOfPath = (YCHAR *)path;
;;;327    	}
;;;328    	else
;;;329    	{
;;;330    		dir = yaffsfs_FindRoot(path,&restOfPath);
;;;331    	}
;;;332    
;;;333    	while(dir)
;;;334    	{
;;;335    		// parse off /.
;;;336    		// curve ball: also throw away surplus '/'
;;;337    		// eg. "/ram/x////ff" gets treated the same as "/ram/x/ff"
;;;338    		while(yaffsfs_IsPathDivider(*restOfPath))
;;;339    		{
;;;340    			restOfPath++; // get rid of '/'
;;;341    		}
;;;342    
;;;343    		*name = restOfPath;
;;;344    		i = 0;
;;;345    
;;;346    		while(*restOfPath && !yaffsfs_IsPathDivider(*restOfPath))
;;;347    		{
;;;348    			if (i < YAFFS_MAX_NAME_LENGTH)
;;;349    			{
;;;350    				str[i] = *restOfPath;
;;;351    				str[i+1] = '\0';
;;;352    				i++;
;;;353    			}
;;;354    			restOfPath++;
;;;355    		}
;;;356    
;;;357    		if(!*restOfPath)
;;;358    		{
;;;359    			// got to the end of the string
;;;360    			return dir;
;;;361    		}
;;;362    		else
;;;363    		{
;;;364    			if(yaffs_strcmp(str,_Y(".")) == 0)
;;;365    			{
;;;366    				// Do nothing
;;;367    			}
;;;368    			else if(yaffs_strcmp(str,_Y("..")) == 0)
;;;369    			{
;;;370    				dir = dir->parent;
;;;371    			}
;;;372    			else
;;;373    			{
;;;374    				dir = yaffs_FindObjectByName(dir,str);
;;;375    
;;;376    				while(dir && dir->variantType == YAFFS_OBJECT_TYPE_SYMLINK)
;;;377    				{
;;;378    
;;;379    					dir = yaffsfs_FollowLink(dir,symDepth);
;;;380    
;;;381    				}
;;;382    
;;;383    				if(dir && dir->variantType != YAFFS_OBJECT_TYPE_DIRECTORY)
;;;384    				{
;;;385    					dir = NULL;
;;;386    				}
;;;387    			}
;;;388    		}
;;;389    	}
;;;390    	// directory did not exist.
;;;391    	return NULL;
;;;392    }
0001ce  b041              ADD      sp,sp,#0x104
0001d0  e8bd83f0          POP      {r4-r9,pc}
                  |L1.468|
0001d4  b116              CBZ      r6,|L1.476|
0001d6  4634              MOV      r4,r6                 ;325
0001d8  9740              STR      r7,[sp,#0x100]        ;326
0001da  e004              B        |L1.486|
                  |L1.476|
0001dc  a940              ADD      r1,sp,#0x100          ;330
0001de  4638              MOV      r0,r7                 ;330
0001e0  f7fffffe          BL       yaffsfs_FindRoot
0001e4  4604              MOV      r4,r0                 ;330
                  |L1.486|
0001e6  e04c              B        |L1.642|
                  |L1.488|
0001e8  e002              B        |L1.496|
                  |L1.490|
0001ea  9840              LDR      r0,[sp,#0x100]        ;340
0001ec  1c40              ADDS     r0,r0,#1              ;340
0001ee  9040              STR      r0,[sp,#0x100]        ;340
                  |L1.496|
0001f0  9940              LDR      r1,[sp,#0x100]        ;338
0001f2  7808              LDRB     r0,[r1,#0]            ;338
0001f4  f7fffffe          BL       yaffsfs_IsPathDivider
0001f8  2800              CMP      r0,#0                 ;338
0001fa  d1f6              BNE      |L1.490|
0001fc  9840              LDR      r0,[sp,#0x100]        ;343
0001fe  f8c90000          STR      r0,[r9,#0]            ;343
000202  2500              MOVS     r5,#0                 ;344
000204  e00d              B        |L1.546|
                  |L1.518|
000206  2dff              CMP      r5,#0xff              ;348
000208  da08              BGE      |L1.540|
00020a  9840              LDR      r0,[sp,#0x100]        ;350
00020c  7800              LDRB     r0,[r0,#0]            ;350
00020e  f80d0005          STRB     r0,[sp,r5]            ;350
000212  2100              MOVS     r1,#0                 ;351
000214  1c68              ADDS     r0,r5,#1              ;351
000216  f80d1000          STRB     r1,[sp,r0]            ;351
00021a  1c6d              ADDS     r5,r5,#1              ;352
                  |L1.540|
00021c  9840              LDR      r0,[sp,#0x100]        ;354
00021e  1c40              ADDS     r0,r0,#1              ;354
000220  9040              STR      r0,[sp,#0x100]        ;354
                  |L1.546|
000222  9840              LDR      r0,[sp,#0x100]        ;346
000224  7800              LDRB     r0,[r0,#0]            ;346
000226  b128              CBZ      r0,|L1.564|
000228  9940              LDR      r1,[sp,#0x100]        ;346
00022a  7808              LDRB     r0,[r1,#0]            ;346
00022c  f7fffffe          BL       yaffsfs_IsPathDivider
000230  2800              CMP      r0,#0                 ;346
000232  d0e8              BEQ      |L1.518|
                  |L1.564|
000234  9840              LDR      r0,[sp,#0x100]        ;357
000236  7800              LDRB     r0,[r0,#0]            ;357
000238  b908              CBNZ     r0,|L1.574|
00023a  4620              MOV      r0,r4                 ;360
00023c  e7c7              B        |L1.462|
                  |L1.574|
00023e  a174              ADR      r1,|L1.1040|
000240  4668              MOV      r0,sp                 ;364
000242  f7fffffe          BL       strcmp
000246  b1e0              CBZ      r0,|L1.642|
000248  a172              ADR      r1,|L1.1044|
00024a  4668              MOV      r0,sp                 ;368
00024c  f7fffffe          BL       strcmp
000250  b908              CBNZ     r0,|L1.598|
000252  69e4              LDR      r4,[r4,#0x1c]         ;370
000254  e015              B        |L1.642|
                  |L1.598|
000256  4669              MOV      r1,sp                 ;374
000258  4620              MOV      r0,r4                 ;374
00025a  f7fffffe          BL       yaffs_FindObjectByName
00025e  4604              MOV      r4,r0                 ;374
000260  e004              B        |L1.620|
                  |L1.610|
000262  4641              MOV      r1,r8                 ;379
000264  4620              MOV      r0,r4                 ;379
000266  f7fffffe          BL       yaffsfs_FollowLink
00026a  4604              MOV      r4,r0                 ;379
                  |L1.620|
00026c  b11c              CBZ      r4,|L1.630|
00026e  f8940054          LDRB     r0,[r4,#0x54]         ;376
000272  2802              CMP      r0,#2                 ;376
000274  d0f5              BEQ      |L1.610|
                  |L1.630|
000276  b124              CBZ      r4,|L1.642|
000278  f8940054          LDRB     r0,[r4,#0x54]         ;383
00027c  2803              CMP      r0,#3                 ;383
00027e  d000              BEQ      |L1.642|
000280  2400              MOVS     r4,#0                 ;385
                  |L1.642|
000282  2c00              CMP      r4,#0                 ;333
000284  d1b0              BNE      |L1.488|
000286  2000              MOVS     r0,#0                 ;391
000288  e7a1              B        |L1.462|
;;;393    
                          ENDP

                  yaffsfs_FindDirectory PROC
;;;394    static yaffs_Object *yaffsfs_FindDirectory(yaffs_Object *relativeDirectory,const YCHAR *path,YCHAR **name,int symDepth)
00028a  e92d41f0          PUSH     {r4-r8,lr}
;;;395    {
00028e  4604              MOV      r4,r0
000290  460d              MOV      r5,r1
000292  4616              MOV      r6,r2
000294  461f              MOV      r7,r3
;;;396    	return yaffsfs_DoFindDirectory(relativeDirectory,path,name,symDepth);
000296  463b              MOV      r3,r7
000298  4632              MOV      r2,r6
00029a  4629              MOV      r1,r5
00029c  4620              MOV      r0,r4
00029e  f7fffffe          BL       yaffsfs_DoFindDirectory
;;;397    }
0002a2  e8bd81f0          POP      {r4-r8,pc}
;;;398    
                          ENDP

                  yaffsfs_FindObject PROC
;;;400    //
;;;401    static yaffs_Object *yaffsfs_FindObject(yaffs_Object *relativeDirectory, const YCHAR *path,int symDepth)
0002a6  b5f8              PUSH     {r3-r7,lr}
;;;402    {
0002a8  4606              MOV      r6,r0
0002aa  460f              MOV      r7,r1
0002ac  4614              MOV      r4,r2
;;;403    	yaffs_Object *dir;
;;;404    	YCHAR *name;
;;;405    
;;;406    	dir = yaffsfs_FindDirectory(relativeDirectory,path,&name,symDepth);
0002ae  4623              MOV      r3,r4
0002b0  466a              MOV      r2,sp
0002b2  4639              MOV      r1,r7
0002b4  4630              MOV      r0,r6
0002b6  f7fffffe          BL       yaffsfs_FindDirectory
0002ba  4605              MOV      r5,r0
;;;407    
;;;408    	if(dir && *name)
0002bc  b13d              CBZ      r5,|L1.718|
0002be  9800              LDR      r0,[sp,#0]
0002c0  7800              LDRB     r0,[r0,#0]
0002c2  b120              CBZ      r0,|L1.718|
;;;409    	{
;;;410    		return yaffs_FindObjectByName(dir,name);
0002c4  4628              MOV      r0,r5
0002c6  9900              LDR      r1,[sp,#0]
0002c8  f7fffffe          BL       yaffs_FindObjectByName
                  |L1.716|
;;;411    	}
;;;412    
;;;413    	return dir;
;;;414    }
0002cc  bdf8              POP      {r3-r7,pc}
                  |L1.718|
0002ce  4628              MOV      r0,r5                 ;413
0002d0  e7fc              B        |L1.716|
;;;415    
                          ENDP

                  yaffsfs_FollowLink PROC
;;;284    
;;;285    static yaffs_Object *yaffsfs_FollowLink(yaffs_Object *obj,int symDepth)
0002d2  b570              PUSH     {r4-r6,lr}
;;;286    {
0002d4  4604              MOV      r4,r0
0002d6  460d              MOV      r5,r1
;;;287    
;;;288    	while(obj && obj->variantType == YAFFS_OBJECT_TYPE_SYMLINK)
0002d8  e014              B        |L1.772|
                  |L1.730|
;;;289    	{
;;;290    		YCHAR *alias = obj->variant.symLinkVariant.alias;
0002da  6da6              LDR      r6,[r4,#0x58]
;;;291    
;;;292    		if(yaffsfs_IsPathDivider(*alias))
0002dc  7830              LDRB     r0,[r6,#0]
0002de  f7fffffe          BL       yaffsfs_IsPathDivider
0002e2  b138              CBZ      r0,|L1.756|
;;;293    		{
;;;294    			// Starts with a /, need to scan from root up
;;;295    			obj = yaffsfs_FindObject(NULL,alias,symDepth++);
0002e4  462a              MOV      r2,r5
0002e6  1c6d              ADDS     r5,r5,#1
0002e8  4631              MOV      r1,r6
0002ea  2000              MOVS     r0,#0
0002ec  f7fffffe          BL       yaffsfs_FindObject
0002f0  4604              MOV      r4,r0
0002f2  e006              B        |L1.770|
                  |L1.756|
;;;296    		}
;;;297    		else
;;;298    		{
;;;299    			// Relative to here, so use the parent of the symlink as a start
;;;300    			obj = yaffsfs_FindObject(obj->parent,alias,symDepth++);
0002f4  462a              MOV      r2,r5
0002f6  1c6d              ADDS     r5,r5,#1
0002f8  4631              MOV      r1,r6
0002fa  69e0              LDR      r0,[r4,#0x1c]
0002fc  f7fffffe          BL       yaffsfs_FindObject
000300  4604              MOV      r4,r0
                  |L1.770|
;;;301    		}
;;;302    	}
000302  bf00              NOP      
                  |L1.772|
000304  b11c              CBZ      r4,|L1.782|
000306  f8940054          LDRB     r0,[r4,#0x54]         ;288
00030a  2802              CMP      r0,#2                 ;288
00030c  d0e5              BEQ      |L1.730|
                  |L1.782|
;;;303    	return obj;
00030e  4620              MOV      r0,r4
;;;304    }
000310  bd70              POP      {r4-r6,pc}
;;;305    
                          ENDP

                  yaffs_open PROC
;;;444    
;;;445    int yaffs_open(const YCHAR *path, int oflag, int mode)
000312  e92d4ff7          PUSH     {r0-r2,r4-r11,lr}
;;;446    {
000316  b086              SUB      sp,sp,#0x18
000318  4681              MOV      r9,r0
00031a  460d              MOV      r5,r1
;;;447    	yaffs_Object *obj = NULL;
00031c  2400              MOVS     r4,#0
;;;448    	yaffs_Object *dir = NULL;
00031e  46a2              MOV      r10,r4
;;;449    	YCHAR *name;
;;;450    	int handle = -1;
000320  f04f38ff          MOV      r8,#0xffffffff
;;;451    	yaffsfs_Handle *h = NULL;
000324  2600              MOVS     r6,#0
;;;452    	int alreadyOpen = 0;
000326  46a3              MOV      r11,r4
;;;453    	int alreadyExclusive = 0;
000328  2000              MOVS     r0,#0
00032a  9004              STR      r0,[sp,#0x10]
;;;454    	int openDenied = 0;
00032c  9003              STR      r0,[sp,#0xc]
;;;455    	int symDepth = 0;
00032e  9002              STR      r0,[sp,#8]
;;;456    	int errorReported = 0;
000330  9001              STR      r0,[sp,#4]
;;;457    
;;;458    	int i;
;;;459    
;;;460    
;;;461    	// todo sanity check oflag (eg. can't have O_TRUNC without WRONLY or RDWR
;;;462    
;;;463    
;;;464    	yaffsfs_Lock();
000332  f7fffffe          BL       yaffsfs_Lock
;;;465    
;;;466    	handle = yaffsfs_GetHandle();
000336  f7fffffe          BL       yaffsfs_GetHandle
00033a  4680              MOV      r8,r0
;;;467    
;;;468    	if(handle >= 0)
00033c  f1b80f00          CMP      r8,#0
000340  db5f              BLT      |L1.1026|
;;;469    	{
;;;470    
;;;471    		h = yaffsfs_GetHandlePointer(handle);
000342  4640              MOV      r0,r8
000344  f7fffffe          BL       yaffsfs_GetHandlePointer
000348  4606              MOV      r6,r0
;;;472    
;;;473    
;;;474    		// try to find the exisiting object
;;;475    		obj = yaffsfs_FindObject(NULL,path,0);
00034a  2200              MOVS     r2,#0
00034c  4649              MOV      r1,r9
00034e  4610              MOV      r0,r2
000350  f7fffffe          BL       yaffsfs_FindObject
000354  4604              MOV      r4,r0
;;;476    
;;;477    		if(obj && obj->variantType == YAFFS_OBJECT_TYPE_SYMLINK)
000356  b15c              CBZ      r4,|L1.880|
000358  f8940054          LDRB     r0,[r4,#0x54]
00035c  2802              CMP      r0,#2
00035e  d107              BNE      |L1.880|
;;;478    		{
;;;479    
;;;480    			obj = yaffsfs_FollowLink(obj,symDepth++);
000360  9802              LDR      r0,[sp,#8]
000362  1c42              ADDS     r2,r0,#1
000364  4601              MOV      r1,r0
000366  4620              MOV      r0,r4
000368  9202              STR      r2,[sp,#8]
00036a  f7fffffe          BL       yaffsfs_FollowLink
00036e  4604              MOV      r4,r0
                  |L1.880|
;;;481    		}
;;;482    
;;;483    		if(obj && obj->variantType != YAFFS_OBJECT_TYPE_FILE)
000370  b124              CBZ      r4,|L1.892|
000372  f8940054          LDRB     r0,[r4,#0x54]
000376  2801              CMP      r0,#1
000378  d000              BEQ      |L1.892|
;;;484    		{
;;;485    			obj = NULL;
00037a  2400              MOVS     r4,#0
                  |L1.892|
;;;486    		}
;;;487    
;;;488    		if(obj)
00037c  2c00              CMP      r4,#0
00037e  d064              BEQ      |L1.1098|
;;;489    		{
;;;490    			// Check if the object is already in use
;;;491    			alreadyOpen = alreadyExclusive = 0;
000380  2000              MOVS     r0,#0
000382  4683              MOV      r11,r0
000384  9004              STR      r0,[sp,#0x10]
;;;492    
;;;493    			for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000386  2700              MOVS     r7,#0
000388  e01c              B        |L1.964|
                  |L1.906|
;;;494    			{
;;;495    
;;;496    				if(i != handle &&
00038a  4547              CMP      r7,r8
00038c  d019              BEQ      |L1.962|
;;;497    				   yaffsfs_handle[i].inUse &&
00038e  eb070047          ADD      r0,r7,r7,LSL #1
000392  491c              LDR      r1,|L1.1028|
000394  f8110020          LDRB     r0,[r1,r0,LSL #2]
000398  f0000001          AND      r0,r0,#1
00039c  b188              CBZ      r0,|L1.962|
;;;498    				    obj == yaffsfs_handle[i].obj)
00039e  eb070047          ADD      r0,r7,r7,LSL #1
0003a2  eb010080          ADD      r0,r1,r0,LSL #2
0003a6  6880              LDR      r0,[r0,#8]
0003a8  42a0              CMP      r0,r4
0003aa  d10a              BNE      |L1.962|
;;;499    				 {
;;;500    				 	alreadyOpen = 1;
0003ac  f04f0b01          MOV      r11,#1
;;;501    					if(yaffsfs_handle[i].exclusive)
0003b0  eb070047          ADD      r0,r7,r7,LSL #1
0003b4  f8110020          LDRB     r0,[r1,r0,LSL #2]
0003b8  f3c000c0          UBFX     r0,r0,#3,#1
0003bc  b108              CBZ      r0,|L1.962|
;;;502    					{
;;;503    						alreadyExclusive = 1;
0003be  2001              MOVS     r0,#1
0003c0  9004              STR      r0,[sp,#0x10]
                  |L1.962|
0003c2  1c7f              ADDS     r7,r7,#1              ;493
                  |L1.964|
0003c4  2fc8              CMP      r7,#0xc8              ;493
0003c6  dbe0              BLT      |L1.906|
;;;504    					}
;;;505    				 }
;;;506    			}
;;;507    
;;;508    			if(((oflag & O_EXCL) && alreadyOpen) || alreadyExclusive)
0003c8  f0050080          AND      r0,r5,#0x80
0003cc  b110              CBZ      r0,|L1.980|
0003ce  f1bb0f00          CMP      r11,#0
0003d2  d101              BNE      |L1.984|
                  |L1.980|
0003d4  9804              LDR      r0,[sp,#0x10]
0003d6  b108              CBZ      r0,|L1.988|
                  |L1.984|
;;;509    			{
;;;510    				openDenied = 1;
0003d8  2001              MOVS     r0,#1
0003da  9003              STR      r0,[sp,#0xc]
                  |L1.988|
;;;511    			}
;;;512    
;;;513    			// Open should fail if O_CREAT and O_EXCL are specified
;;;514    			if((oflag & O_EXCL) && (oflag & O_CREAT))
0003dc  f0050080          AND      r0,r5,#0x80
0003e0  b150              CBZ      r0,|L1.1016|
0003e2  f0050040          AND      r0,r5,#0x40
0003e6  b138              CBZ      r0,|L1.1016|
;;;515    			{
;;;516    				openDenied = 1;
0003e8  2001              MOVS     r0,#1
0003ea  9003              STR      r0,[sp,#0xc]
;;;517    				yaffsfs_SetError(-EEXIST);
0003ec  f06f0010          MVN      r0,#0x10
0003f0  f7fffffe          BL       yaffsfs_SetError
;;;518    				errorReported = 1;
0003f4  2001              MOVS     r0,#1
0003f6  9001              STR      r0,[sp,#4]
                  |L1.1016|
;;;519    			}
;;;520    
;;;521    			// Check file permissions
;;;522    			if( (oflag & (O_RDWR | O_WRONLY)) == 0 &&     // ie O_RDONLY
0003f8  f0050003          AND      r0,r5,#3
0003fc  b988              CBNZ     r0,|L1.1058|
;;;523    			   !(obj->yst_mode & S_IREAD))
0003fe  8ea0              LDRH     r0,[r4,#0x34]
000400  e00a              B        |L1.1048|
                  |L1.1026|
000402  e07a              B        |L1.1274|
                  |L1.1028|
                          DCD      yaffsfs_handle
                  |L1.1032|
000408  2f00              DCB      "/",0
00040a  00                DCB      0
00040b  00                DCB      0
                  |L1.1036|
                          DCD      yaffsfs_configurationList
                  |L1.1040|
000410  2e00              DCB      ".",0
000412  00                DCB      0
000413  00                DCB      0
                  |L1.1044|
000414  2e2e00            DCB      "..",0
000417  00                DCB      0
                  |L1.1048|
000418  f4007080          AND      r0,r0,#0x100
00041c  b908              CBNZ     r0,|L1.1058|
;;;524    			{
;;;525    				openDenied = 1;
00041e  2001              MOVS     r0,#1
000420  9003              STR      r0,[sp,#0xc]
                  |L1.1058|
;;;526    			}
;;;527    
;;;528    			if( (oflag & O_RDWR) &&
000422  f0050002          AND      r0,r5,#2
000426  b128              CBZ      r0,|L1.1076|
;;;529    			   !(obj->yst_mode & S_IREAD))
000428  8ea0              LDRH     r0,[r4,#0x34]
00042a  f4007080          AND      r0,r0,#0x100
00042e  b908              CBNZ     r0,|L1.1076|
;;;530    			{
;;;531    				openDenied = 1;
000430  2001              MOVS     r0,#1
000432  9003              STR      r0,[sp,#0xc]
                  |L1.1076|
;;;532    			}
;;;533    
;;;534    			if( (oflag & (O_RDWR | O_WRONLY)) &&
000434  f0050003          AND      r0,r5,#3
000438  b320              CBZ      r0,|L1.1156|
;;;535    			   !(obj->yst_mode & S_IWRITE))
00043a  f8940034          LDRB     r0,[r4,#0x34]
00043e  f0000080          AND      r0,r0,#0x80
000442  b9f8              CBNZ     r0,|L1.1156|
;;;536    			{
;;;537    				openDenied = 1;
000444  2001              MOVS     r0,#1
000446  9003              STR      r0,[sp,#0xc]
000448  e01c              B        |L1.1156|
                  |L1.1098|
;;;538    			}
;;;539    
;;;540    		}
;;;541    
;;;542    		else if((oflag & O_CREAT))
00044a  f0050040          AND      r0,r5,#0x40
00044e  b1c8              CBZ      r0,|L1.1156|
;;;543    		{
;;;544    			// Let's see if we can create this file
;;;545    			dir = yaffsfs_FindDirectory(NULL,path,&name,0);
000450  2300              MOVS     r3,#0
000452  aa05              ADD      r2,sp,#0x14
000454  4649              MOV      r1,r9
000456  4618              MOV      r0,r3
000458  f7fffffe          BL       yaffsfs_FindDirectory
00045c  4682              MOV      r10,r0
;;;546    			if(dir)
00045e  f1ba0f00          CMP      r10,#0
000462  d009              BEQ      |L1.1144|
;;;547    			{
;;;548     				obj = yaffs_MknodFile(dir,name,mode,0,0);
000464  2000              MOVS     r0,#0
000466  4603              MOV      r3,r0
000468  9000              STR      r0,[sp,#0]
00046a  4650              MOV      r0,r10
00046c  9a08              LDR      r2,[sp,#0x20]
00046e  9905              LDR      r1,[sp,#0x14]
000470  f7fffffe          BL       yaffs_MknodFile
000474  4604              MOV      r4,r0
000476  e005              B        |L1.1156|
                  |L1.1144|
;;;549     
;;;550    			}
;;;551    			else
;;;552    			{
;;;553    				yaffsfs_SetError(-ENOTDIR);
000478  f06f0013          MVN      r0,#0x13
00047c  f7fffffe          BL       yaffsfs_SetError
;;;554    				errorReported = 1;
000480  2001              MOVS     r0,#1
000482  9001              STR      r0,[sp,#4]
                  |L1.1156|
;;;555    			}
;;;556    		}
;;;557                     
;;;558    
;;;559    		if(obj && !openDenied)
000484  b364              CBZ      r4,|L1.1248|
000486  9803              LDR      r0,[sp,#0xc]
000488  bb50              CBNZ     r0,|L1.1248|
;;;560    		{
;;;561    			h->obj = obj;
00048a  60b4              STR      r4,[r6,#8]
;;;562    			h->inUse = 1;
00048c  7830              LDRB     r0,[r6,#0]
00048e  f0200001          BIC      r0,r0,#1
000492  1c40              ADDS     r0,r0,#1
000494  7030              STRB     r0,[r6,#0]
;;;563    	    	h->readOnly = (oflag & (O_WRONLY | O_RDWR)) ? 0 : 1;
000496  f0050003          AND      r0,r5,#3
00049a  b908              CBNZ     r0,|L1.1184|
00049c  2001              MOVS     r0,#1
00049e  e000              B        |L1.1186|
                  |L1.1184|
0004a0  2000              MOVS     r0,#0
                  |L1.1186|
0004a2  7831              LDRB     r1,[r6,#0]
0004a4  f3600141          BFI      r1,r0,#1,#1
0004a8  7031              STRB     r1,[r6,#0]
;;;564    			h->append =  (oflag & O_APPEND) ? 1 : 0;
0004aa  0aa8              LSRS     r0,r5,#10
0004ac  7831              LDRB     r1,[r6,#0]
0004ae  f3600182          BFI      r1,r0,#2,#1
0004b2  7031              STRB     r1,[r6,#0]
;;;565    			h->exclusive = (oflag & O_EXCL) ? 1 : 0;
0004b4  09e8              LSRS     r0,r5,#7
0004b6  7831              LDRB     r1,[r6,#0]
0004b8  f36001c3          BFI      r1,r0,#3,#1
0004bc  7031              STRB     r1,[r6,#0]
;;;566    			h->position = 0;
0004be  2000              MOVS     r0,#0
0004c0  6070              STR      r0,[r6,#4]
;;;567    
;;;568                            obj->inUse++;
0004c2  6ba0              LDR      r0,[r4,#0x38]
0004c4  1c40              ADDS     r0,r0,#1
0004c6  63a0              STR      r0,[r4,#0x38]
;;;569                            if((oflag & O_TRUNC) && !h->readOnly)
0004c8  f4057000          AND      r0,r5,#0x200
0004cc  b1a8              CBZ      r0,|L1.1274|
0004ce  7830              LDRB     r0,[r6,#0]
0004d0  f3c00040          UBFX     r0,r0,#1,#1
0004d4  b988              CBNZ     r0,|L1.1274|
;;;570                            {
;;;571                                    yaffs_ResizeFile(obj,0);
0004d6  2100              MOVS     r1,#0
0004d8  4620              MOV      r0,r4
0004da  f7fffffe          BL       yaffs_ResizeFile
0004de  e00c              B        |L1.1274|
                  |L1.1248|
;;;572                            }
;;;573     
;;;574    		}
;;;575    		else
;;;576    		{
;;;577    			yaffsfs_PutHandle(handle);
0004e0  4640              MOV      r0,r8
0004e2  f7fffffe          BL       yaffsfs_PutHandle
;;;578    			if(!errorReported)
0004e6  9801              LDR      r0,[sp,#4]
0004e8  b928              CBNZ     r0,|L1.1270|
;;;579    			{
;;;580    				yaffsfs_SetError(-EACCES);
0004ea  f06f000c          MVN      r0,#0xc
0004ee  f7fffffe          BL       yaffsfs_SetError
;;;581    				errorReported = 1;
0004f2  2001              MOVS     r0,#1
0004f4  9001              STR      r0,[sp,#4]
                  |L1.1270|
;;;582    			}
;;;583    			handle = -1;
0004f6  f04f38ff          MOV      r8,#0xffffffff
                  |L1.1274|
;;;584    		}
;;;585    
;;;586    	}
;;;587    
;;;588    	yaffsfs_Unlock();
0004fa  f7fffffe          BL       yaffsfs_Unlock
;;;589    
;;;590    	return handle;
0004fe  4640              MOV      r0,r8
;;;591    }
000500  b009              ADD      sp,sp,#0x24
000502  e8bd8ff0          POP      {r4-r11,pc}
;;;592    
                          ENDP

                  yaffs_close PROC
;;;619    
;;;620    int yaffs_close(int fd)
000506  b570              PUSH     {r4-r6,lr}
;;;621    {
000508  4605              MOV      r5,r0
;;;622    	yaffsfs_Handle *h = NULL;
00050a  2400              MOVS     r4,#0
;;;623    	int retVal = 0;
00050c  2600              MOVS     r6,#0
;;;624    
;;;625    	yaffsfs_Lock();
00050e  f7fffffe          BL       yaffsfs_Lock
;;;626    
;;;627    	h = yaffsfs_GetHandlePointer(fd);
000512  4628              MOV      r0,r5
000514  f7fffffe          BL       yaffsfs_GetHandlePointer
000518  4604              MOV      r4,r0
;;;628    
;;;629    	if(h && h->inUse)
00051a  b1e4              CBZ      r4,|L1.1366|
00051c  7820              LDRB     r0,[r4,#0]
00051e  f0000001          AND      r0,r0,#1
000522  b1c0              CBZ      r0,|L1.1366|
;;;630    	{
;;;631    		// clean up
;;;632    		yaffs_FlushFile(h->obj,1);
000524  2101              MOVS     r1,#1
000526  68a0              LDR      r0,[r4,#8]
000528  f7fffffe          BL       yaffs_FlushFile
;;;633    		h->obj->inUse--;
00052c  68a0              LDR      r0,[r4,#8]
00052e  6b80              LDR      r0,[r0,#0x38]
000530  1e40              SUBS     r0,r0,#1
000532  68a1              LDR      r1,[r4,#8]
000534  6388              STR      r0,[r1,#0x38]
;;;634    		if(h->obj->inUse <= 0 && h->obj->unlinked)
000536  68a0              LDR      r0,[r4,#8]
000538  6b80              LDR      r0,[r0,#0x38]
00053a  b938              CBNZ     r0,|L1.1356|
00053c  68a0              LDR      r0,[r4,#8]
00053e  7800              LDRB     r0,[r0,#0]
000540  f3c00080          UBFX     r0,r0,#2,#1
000544  b110              CBZ      r0,|L1.1356|
;;;635    		{
;;;636    			yaffs_DeleteFile(h->obj);
000546  68a0              LDR      r0,[r4,#8]
000548  f7fffffe          BL       yaffs_DeleteFile
                  |L1.1356|
;;;637    		}
;;;638    		yaffsfs_PutHandle(fd);
00054c  4628              MOV      r0,r5
00054e  f7fffffe          BL       yaffsfs_PutHandle
;;;639    		retVal = 0;
000552  2600              MOVS     r6,#0
000554  e005              B        |L1.1378|
                  |L1.1366|
;;;640    	}
;;;641    	else
;;;642    	{
;;;643    		// bad handle
;;;644    		yaffsfs_SetError(-EBADF);
000556  f06f0008          MVN      r0,#8
00055a  f7fffffe          BL       yaffsfs_SetError
;;;645    		retVal = -1;
00055e  f04f36ff          MOV      r6,#0xffffffff
                  |L1.1378|
;;;646    	}
;;;647    
;;;648    	yaffsfs_Unlock();
000562  f7fffffe          BL       yaffsfs_Unlock
;;;649    
;;;650    	return retVal;
000566  4630              MOV      r0,r6
;;;651    }
000568  bd70              POP      {r4-r6,pc}
;;;652    
                          ENDP

                  yaffs_pread PROC
;;;714    
;;;715    int yaffs_pread(int fd, void *buf, unsigned int nbyte, unsigned int offset)
00056a  e92d5fff          PUSH     {r0-r12,lr}
;;;716    {
00056e  4682              MOV      r10,r0
000570  4614              MOV      r4,r2
000572  461e              MOV      r6,r3
;;;717    	yaffsfs_Handle *h = NULL;
000574  f04f0900          MOV      r9,#0
;;;718    	yaffs_Object *obj = NULL;
000578  2700              MOVS     r7,#0
;;;719    	int pos = 0;
00057a  46b8              MOV      r8,r7
;;;720    	int nRead = -1;
00057c  f04f3bff          MOV      r11,#0xffffffff
;;;721    	unsigned int maxRead;
;;;722    
;;;723    	yaffsfs_Lock();
000580  f7fffffe          BL       yaffsfs_Lock
;;;724    	h = yaffsfs_GetHandlePointer(fd);
000584  4650              MOV      r0,r10
000586  f7fffffe          BL       yaffsfs_GetHandlePointer
00058a  4681              MOV      r9,r0
;;;725    	obj = yaffsfs_GetHandleObject(fd);
00058c  4650              MOV      r0,r10
00058e  f7fffffe          BL       yaffsfs_GetHandleObject
000592  4607              MOV      r7,r0
;;;726    
;;;727    	if(!h || !obj)
000594  f1b90f00          CMP      r9,#0
000598  d000              BEQ      |L1.1436|
00059a  b927              CBNZ     r7,|L1.1446|
                  |L1.1436|
;;;728    	{
;;;729    		// bad handle
;;;730    		yaffsfs_SetError(-EBADF);
00059c  f06f0008          MVN      r0,#8
0005a0  f7fffffe          BL       yaffsfs_SetError
0005a4  e01e              B        |L1.1508|
                  |L1.1446|
;;;731    	}
;;;732    	else if( h && obj)
0005a6  f1b90f00          CMP      r9,#0
0005aa  d01b              BEQ      |L1.1508|
0005ac  b1d7              CBZ      r7,|L1.1508|
;;;733    	{
;;;734    		pos= offset;
0005ae  46b0              MOV      r8,r6
;;;735    		if(yaffs_GetObjectFileLength(obj) > pos)
0005b0  4638              MOV      r0,r7
0005b2  f7fffffe          BL       yaffs_GetObjectFileLength
0005b6  4540              CMP      r0,r8
0005b8  dd05              BLE      |L1.1478|
;;;736    		{
;;;737    			maxRead = yaffs_GetObjectFileLength(obj) - pos;
0005ba  4638              MOV      r0,r7
0005bc  f7fffffe          BL       yaffs_GetObjectFileLength
0005c0  eba00508          SUB      r5,r0,r8
0005c4  e000              B        |L1.1480|
                  |L1.1478|
;;;738    		}
;;;739    		else
;;;740    		{
;;;741    			maxRead = 0;
0005c6  2500              MOVS     r5,#0
                  |L1.1480|
;;;742    		}
;;;743    
;;;744    		if(nbyte > maxRead)
0005c8  42ac              CMP      r4,r5
0005ca  d900              BLS      |L1.1486|
;;;745    		{
;;;746    			nbyte = maxRead;
0005cc  462c              MOV      r4,r5
                  |L1.1486|
;;;747    		}
;;;748    
;;;749    
;;;750    		if(nbyte > 0)
0005ce  b13c              CBZ      r4,|L1.1504|
;;;751    		{
;;;752    			nRead = yaffs_ReadDataFromFile(obj,buf,pos,nbyte);
0005d0  4623              MOV      r3,r4
0005d2  4642              MOV      r2,r8
0005d4  4638              MOV      r0,r7
0005d6  9901              LDR      r1,[sp,#4]
0005d8  f7fffffe          BL       yaffs_ReadDataFromFile
0005dc  4683              MOV      r11,r0
0005de  e001              B        |L1.1508|
                  |L1.1504|
;;;753    		}
;;;754    		else
;;;755    		{
;;;756    			nRead = 0;
0005e0  f04f0b00          MOV      r11,#0
                  |L1.1508|
;;;757    		}
;;;758    
;;;759    	}
;;;760    
;;;761    	yaffsfs_Unlock();
0005e4  f7fffffe          BL       yaffsfs_Unlock
;;;762    
;;;763    
;;;764    	return (nRead >= 0) ? nRead : -1;
0005e8  f1bb0f00          CMP      r11,#0
0005ec  db03              BLT      |L1.1526|
0005ee  4658              MOV      r0,r11
                  |L1.1520|
;;;765    
;;;766    }
0005f0  b004              ADD      sp,sp,#0x10
0005f2  e8bd9ff0          POP      {r4-r12,pc}
                  |L1.1526|
0005f6  f04f30ff          MOV      r0,#0xffffffff        ;764
0005fa  e7f9              B        |L1.1520|
;;;767    
                          ENDP

                  yaffs_write PROC
;;;768    int yaffs_write(int fd, const void *buf, unsigned int nbyte)
0005fc  e92d4ff8          PUSH     {r3-r11,lr}
;;;769    {
000600  4681              MOV      r9,r0
000602  468a              MOV      r10,r1
000604  4617              MOV      r7,r2
;;;770    	yaffsfs_Handle *h = NULL;
000606  2400              MOVS     r4,#0
;;;771    	yaffs_Object *obj = NULL;
000608  2500              MOVS     r5,#0
;;;772    	int pos = 0;
00060a  46a0              MOV      r8,r4
;;;773    	int nWritten = -1;
00060c  1e66              SUBS     r6,r4,#1
;;;774    	int writeThrough = 0;
00060e  46a3              MOV      r11,r4
;;;775    
;;;776    	yaffsfs_Lock();
000610  f7fffffe          BL       yaffsfs_Lock
;;;777    	h = yaffsfs_GetHandlePointer(fd);
000614  4648              MOV      r0,r9
000616  f7fffffe          BL       yaffsfs_GetHandlePointer
00061a  4604              MOV      r4,r0
;;;778    	obj = yaffsfs_GetHandleObject(fd);
00061c  4648              MOV      r0,r9
00061e  f7fffffe          BL       yaffsfs_GetHandleObject
000622  4605              MOV      r5,r0
;;;779     
;;;780    	if(!h || !obj)
000624  b104              CBZ      r4,|L1.1576|
000626  b925              CBNZ     r5,|L1.1586|
                  |L1.1576|
;;;781    	{
;;;782     
;;;783    		yaffsfs_SetError(-EBADF);
000628  f06f0008          MVN      r0,#8
00062c  f7fffffe          BL       yaffsfs_SetError
000630  e020              B        |L1.1652|
                  |L1.1586|
;;;784    	}
;;;785    	else if( h && obj && h->readOnly)
000632  b124              CBZ      r4,|L1.1598|
000634  b11d              CBZ      r5,|L1.1598|
000636  7820              LDRB     r0,[r4,#0]
000638  f3c00040          UBFX     r0,r0,#1,#1
00063c  b9d0              CBNZ     r0,|L1.1652|
                  |L1.1598|
;;;786    	{
;;;787    		// todo error
;;;788    	}
;;;789    	else if( h && obj)
00063e  b1cc              CBZ      r4,|L1.1652|
000640  b1c5              CBZ      r5,|L1.1652|
;;;790    	{
;;;791    		if(h->append)
000642  7820              LDRB     r0,[r4,#0]
000644  f3c00080          UBFX     r0,r0,#2,#1
000648  b120              CBZ      r0,|L1.1620|
;;;792    		{
;;;793    		         
;;;794    			pos =  yaffs_GetObjectFileLength(obj);
00064a  4628              MOV      r0,r5
00064c  f7fffffe          BL       yaffs_GetObjectFileLength
000650  4680              MOV      r8,r0
000652  e001              B        |L1.1624|
                  |L1.1620|
;;;795    			 
;;;796    		}
;;;797    		else
;;;798    		{
;;;799    			pos = h->position;
000654  f8d48004          LDR      r8,[r4,#4]
                  |L1.1624|
;;;800    		}
;;;801    
;;;802    		nWritten = yaffs_WriteDataToFile(obj,buf,pos,nbyte,writeThrough);
000658  463b              MOV      r3,r7
00065a  4642              MOV      r2,r8
00065c  4651              MOV      r1,r10
00065e  4628              MOV      r0,r5
000660  f8cdb000          STR      r11,[sp,#0]
000664  f7fffffe          BL       yaffs_WriteDataToFile
000668  4606              MOV      r6,r0
;;;803    
;;;804    		if(nWritten >= 0)
00066a  2e00              CMP      r6,#0
00066c  db02              BLT      |L1.1652|
;;;805    		{
;;;806    			h->position = pos + nWritten;
00066e  eb080006          ADD      r0,r8,r6
000672  6060              STR      r0,[r4,#4]
                  |L1.1652|
;;;807    		}
;;;808    		else
;;;809    		{
;;;810    	 
;;;811    		}
;;;812    
;;;813    	}
;;;814    
;;;815    	yaffsfs_Unlock();
000674  f7fffffe          BL       yaffsfs_Unlock
;;;816    
;;;817    
;;;818    	return (nWritten >= 0) ? nWritten : -1;
000678  2e00              CMP      r6,#0
00067a  db02              BLT      |L1.1666|
00067c  4630              MOV      r0,r6
                  |L1.1662|
;;;819    
;;;820    }
00067e  e8bd8ff8          POP      {r3-r11,pc}
                  |L1.1666|
000682  f04f30ff          MOV      r0,#0xffffffff        ;818
000686  e7fa              B        |L1.1662|
;;;821    
                          ENDP

                  yaffsfs_DoStat PROC
;;;1087   
;;;1088   static int yaffsfs_DoStat(yaffs_Object *obj,struct yaffs_stat *buf)
000688  b570              PUSH     {r4-r6,lr}
;;;1089   {
00068a  4605              MOV      r5,r0
00068c  460c              MOV      r4,r1
;;;1090   	int retVal = -1;
00068e  f04f36ff          MOV      r6,#0xffffffff
;;;1091   
;;;1092   	if(obj)
000692  b11d              CBZ      r5,|L1.1692|
;;;1093   	{
;;;1094   		obj = yaffs_GetEquivalentObject(obj);
000694  4628              MOV      r0,r5
000696  f7fffffe          BL       yaffs_GetEquivalentObject
00069a  4605              MOV      r5,r0
                  |L1.1692|
;;;1095   	}
;;;1096   
;;;1097   	if(obj && buf)
00069c  2d00              CMP      r5,#0
00069e  d042              BEQ      |L1.1830|
0006a0  2c00              CMP      r4,#0
0006a2  d040              BEQ      |L1.1830|
;;;1098   	{
;;;1099       	buf->st_dev = (int)obj->myDev->genericDevice;
0006a4  68a8              LDR      r0,[r5,#8]
0006a6  6b00              LDR      r0,[r0,#0x30]
0006a8  6020              STR      r0,[r4,#0]
;;;1100       	buf->st_ino = obj->objectId;
0006aa  6b28              LDR      r0,[r5,#0x30]
0006ac  6060              STR      r0,[r4,#4]
;;;1101       	buf->st_mode = obj->yst_mode & ~S_IFMT; // clear out file type bits
0006ae  6b68              LDR      r0,[r5,#0x34]
0006b0  f4204070          BIC      r0,r0,#0xf000
0006b4  60a0              STR      r0,[r4,#8]
;;;1102   
;;;1103   		if(obj->variantType == YAFFS_OBJECT_TYPE_DIRECTORY)
0006b6  f8950054          LDRB     r0,[r5,#0x54]
0006ba  2803              CMP      r0,#3
0006bc  d104              BNE      |L1.1736|
;;;1104   		{
;;;1105   			buf->st_mode |= S_IFDIR;
0006be  68a0              LDR      r0,[r4,#8]
0006c0  f4404080          ORR      r0,r0,#0x4000
0006c4  60a0              STR      r0,[r4,#8]
0006c6  e010              B        |L1.1770|
                  |L1.1736|
;;;1106   		}
;;;1107   		else if(obj->variantType == YAFFS_OBJECT_TYPE_SYMLINK)
0006c8  f8950054          LDRB     r0,[r5,#0x54]
0006cc  2802              CMP      r0,#2
0006ce  d104              BNE      |L1.1754|
;;;1108   		{
;;;1109   			buf->st_mode |= S_IFLNK;
0006d0  68a0              LDR      r0,[r4,#8]
0006d2  f4404020          ORR      r0,r0,#0xa000
0006d6  60a0              STR      r0,[r4,#8]
0006d8  e007              B        |L1.1770|
                  |L1.1754|
;;;1110   		}
;;;1111   		else if(obj->variantType == YAFFS_OBJECT_TYPE_FILE)
0006da  f8950054          LDRB     r0,[r5,#0x54]
0006de  2801              CMP      r0,#1
0006e0  d103              BNE      |L1.1770|
;;;1112   		{
;;;1113   			buf->st_mode |= S_IFREG;
0006e2  68a0              LDR      r0,[r4,#8]
0006e4  f4404000          ORR      r0,r0,#0x8000
0006e8  60a0              STR      r0,[r4,#8]
                  |L1.1770|
;;;1114   		}
;;;1115   
;;;1116       	buf->st_nlink = yaffs_GetObjectLinkCount(obj);
0006ea  4628              MOV      r0,r5
0006ec  f7fffffe          BL       yaffs_GetObjectLinkCount
0006f0  60e0              STR      r0,[r4,#0xc]
;;;1117       	buf->st_uid = 0;
0006f2  2000              MOVS     r0,#0
0006f4  6120              STR      r0,[r4,#0x10]
;;;1118       	buf->st_gid = 0;;
0006f6  6160              STR      r0,[r4,#0x14]
;;;1119       	buf->st_rdev = obj->yst_rdev;
0006f8  6d28              LDR      r0,[r5,#0x50]
0006fa  61a0              STR      r0,[r4,#0x18]
;;;1120       	buf->st_size = yaffs_GetObjectFileLength(obj);
0006fc  4628              MOV      r0,r5
0006fe  f7fffffe          BL       yaffs_GetObjectFileLength
000702  61e0              STR      r0,[r4,#0x1c]
;;;1121   		buf->st_blksize = obj->myDev->nDataBytesPerChunk;
000704  68a8              LDR      r0,[r5,#8]
000706  68c0              LDR      r0,[r0,#0xc]
000708  6220              STR      r0,[r4,#0x20]
;;;1122       	buf->st_blocks = (buf->st_size + buf->st_blksize -1)/buf->st_blksize;
00070a  e9d40107          LDRD     r0,r1,[r4,#0x1c]
00070e  4408              ADD      r0,r0,r1
000710  1e40              SUBS     r0,r0,#1
000712  fbb0f0f1          UDIV     r0,r0,r1
000716  6260              STR      r0,[r4,#0x24]
;;;1123   #if CONFIG_YAFFS_WINCE
;;;1124   		buf->yst_wince_atime[0] = obj->win_atime[0];
;;;1125   		buf->yst_wince_atime[1] = obj->win_atime[1];
;;;1126   		buf->yst_wince_ctime[0] = obj->win_ctime[0];
;;;1127   		buf->yst_wince_ctime[1] = obj->win_ctime[1];
;;;1128   		buf->yst_wince_mtime[0] = obj->win_mtime[0];
;;;1129   		buf->yst_wince_mtime[1] = obj->win_mtime[1];
;;;1130   #else
;;;1131       	buf->yst_atime = obj->yst_atime;
000718  6c68              LDR      r0,[r5,#0x44]
00071a  62a0              STR      r0,[r4,#0x28]
;;;1132       	buf->yst_ctime = obj->yst_ctime;
00071c  6ce8              LDR      r0,[r5,#0x4c]
00071e  6320              STR      r0,[r4,#0x30]
;;;1133       	buf->yst_mtime = obj->yst_mtime;
000720  6ca8              LDR      r0,[r5,#0x48]
000722  62e0              STR      r0,[r4,#0x2c]
;;;1134   #endif
;;;1135   		retVal = 0;
000724  2600              MOVS     r6,#0
                  |L1.1830|
;;;1136   	}
;;;1137   	return retVal;
000726  4630              MOV      r0,r6
;;;1138   }
000728  bd70              POP      {r4-r6,pc}
;;;1139   
                          ENDP

                  yaffsfs_DoStatOrLStat PROC
;;;1140   static int yaffsfs_DoStatOrLStat(const YCHAR *path, struct yaffs_stat *buf,int doLStat)
00072a  e92d41f0          PUSH     {r4-r8,lr}
;;;1141   {
00072e  4605              MOV      r5,r0
000730  460f              MOV      r7,r1
000732  4616              MOV      r6,r2
;;;1142   	yaffs_Object *obj;
;;;1143   
;;;1144   	int retVal = -1;
000734  f04f38ff          MOV      r8,#0xffffffff
;;;1145   
;;;1146   	yaffsfs_Lock();
000738  f7fffffe          BL       yaffsfs_Lock
;;;1147   	obj = yaffsfs_FindObject(NULL,path,0);
00073c  2200              MOVS     r2,#0
00073e  4629              MOV      r1,r5
000740  4610              MOV      r0,r2
000742  f7fffffe          BL       yaffsfs_FindObject
000746  4604              MOV      r4,r0
;;;1148   
;;;1149   	if(!doLStat && obj)
000748  b92e              CBNZ     r6,|L1.1878|
00074a  b124              CBZ      r4,|L1.1878|
;;;1150   	{
;;;1151   		obj = yaffsfs_FollowLink(obj,0);
00074c  2100              MOVS     r1,#0
00074e  4620              MOV      r0,r4
000750  f7fffffe          BL       yaffsfs_FollowLink
000754  4604              MOV      r4,r0
                  |L1.1878|
;;;1152   	}
;;;1153   
;;;1154   	if(obj)
000756  b12c              CBZ      r4,|L1.1892|
;;;1155   	{
;;;1156   		retVal = yaffsfs_DoStat(obj,buf);
000758  4639              MOV      r1,r7
00075a  4620              MOV      r0,r4
00075c  f7fffffe          BL       yaffsfs_DoStat
000760  4680              MOV      r8,r0
000762  e003              B        |L1.1900|
                  |L1.1892|
;;;1157   	}
;;;1158   	else
;;;1159   	{
;;;1160   		// todo error not found
;;;1161   		yaffsfs_SetError(-ENOENT);
000764  f06f0001          MVN      r0,#1
000768  f7fffffe          BL       yaffsfs_SetError
                  |L1.1900|
;;;1162   	}
;;;1163   
;;;1164   	yaffsfs_Unlock();
00076c  f7fffffe          BL       yaffsfs_Unlock
;;;1165   
;;;1166   	return retVal;
000770  4640              MOV      r0,r8
;;;1167   
;;;1168   }
000772  e8bd81f0          POP      {r4-r8,pc}
;;;1169   
                          ENDP

                  yaffsfs_DoChMod PROC
;;;1290   
;;;1291   static int yaffsfs_DoChMod(yaffs_Object *obj,mode_t mode)
000776  b570              PUSH     {r4-r6,lr}
;;;1292   {
000778  4604              MOV      r4,r0
00077a  460d              MOV      r5,r1
;;;1293   	int result = -1;
00077c  f04f36ff          MOV      r6,#0xffffffff
;;;1294   
;;;1295   	if(obj)
000780  b11c              CBZ      r4,|L1.1930|
;;;1296   	{
;;;1297   		obj = yaffs_GetEquivalentObject(obj);
000782  4620              MOV      r0,r4
000784  f7fffffe          BL       yaffs_GetEquivalentObject
000788  4604              MOV      r4,r0
                  |L1.1930|
;;;1298   	}
;;;1299   
;;;1300   	if(obj)
00078a  b154              CBZ      r4,|L1.1954|
;;;1301   	{
;;;1302   		obj->yst_mode = mode;
00078c  6365              STR      r5,[r4,#0x34]
;;;1303   		obj->dirty = 1;
00078e  7820              LDRB     r0,[r4,#0]
000790  f0200040          BIC      r0,r0,#0x40
000794  3040              ADDS     r0,r0,#0x40
000796  7020              STRB     r0,[r4,#0]
;;;1304   		result = yaffs_FlushFile(obj,0);
000798  2100              MOVS     r1,#0
00079a  4620              MOV      r0,r4
00079c  f7fffffe          BL       yaffs_FlushFile
0007a0  4606              MOV      r6,r0
                  |L1.1954|
;;;1305   	}
;;;1306   
;;;1307   	return result == YAFFS_OK ? 0 : -1;
0007a2  2e01              CMP      r6,#1
0007a4  d101              BNE      |L1.1962|
0007a6  2000              MOVS     r0,#0
                  |L1.1960|
;;;1308   }
0007a8  bd70              POP      {r4-r6,pc}
                  |L1.1962|
0007aa  f04f30ff          MOV      r0,#0xffffffff        ;1307
0007ae  e7fb              B        |L1.1960|
;;;1309   
                          ENDP

                  yaffs_mkdir PROC
;;;1400   
;;;1401   int yaffs_mkdir(const YCHAR *path, mode_t mode)
0007b0  e92d41fc          PUSH     {r2-r8,lr}
;;;1402   {
0007b4  4605              MOV      r5,r0
0007b6  460e              MOV      r6,r1
;;;1403   	yaffs_Object *parent = NULL;
0007b8  2400              MOVS     r4,#0
;;;1404   	yaffs_Object *dir = NULL;
0007ba  2700              MOVS     r7,#0
;;;1405   	YCHAR *name;
;;;1406   	int retVal= -1;
0007bc  f04f38ff          MOV      r8,#0xffffffff
;;;1407   
;;;1408   	yaffsfs_Lock();
0007c0  f7fffffe          BL       yaffsfs_Lock
;;;1409   	parent = yaffsfs_FindDirectory(NULL,path,&name,0);
0007c4  2300              MOVS     r3,#0
0007c6  aa01              ADD      r2,sp,#4
0007c8  4629              MOV      r1,r5
0007ca  4618              MOV      r0,r3
0007cc  f7fffffe          BL       yaffsfs_FindDirectory
0007d0  4604              MOV      r4,r0
;;;1410   	if(parent)
0007d2  b144              CBZ      r4,|L1.2022|
;;;1411   		dir = yaffs_MknodDirectory(parent,name,mode,0,0);
0007d4  2000              MOVS     r0,#0
0007d6  4603              MOV      r3,r0
0007d8  4632              MOV      r2,r6
0007da  9000              STR      r0,[sp,#0]
0007dc  4620              MOV      r0,r4
0007de  9901              LDR      r1,[sp,#4]
0007e0  f7fffffe          BL       yaffs_MknodDirectory
0007e4  4607              MOV      r7,r0
                  |L1.2022|
;;;1412   	if(dir)
0007e6  b117              CBZ      r7,|L1.2030|
;;;1413   	{
;;;1414   		retVal = 0;
0007e8  f04f0800          MOV      r8,#0
0007ec  e024              B        |L1.2104|
                  |L1.2030|
;;;1415   	}
;;;1416   	else
;;;1417   	{
;;;1418   		if(!parent){
0007ee  b94c              CBNZ     r4,|L1.2052|
;;;1419   			yaffsfs_SetError(-ENOENT); // missing path
0007f0  f06f0001          MVN      r0,#1
0007f4  f7fffffe          BL       yaffsfs_SetError
;;;1420   			put_str_("yaffs mkdir missing path");
0007f8  a16d              ADR      r1,|L1.2480|
0007fa  4874              LDR      r0,|L1.2508|
0007fc  4a74              LDR      r2,|L1.2512|
0007fe  6812              LDR      r2,[r2,#0]  ; _db_msg_
000800  4790              BLX      r2
000802  e012              B        |L1.2090|
                  |L1.2052|
;;;1421   		}
;;;1422   		else if (yaffs_FindObjectByName(parent,name)){
000804  4620              MOV      r0,r4
000806  9901              LDR      r1,[sp,#4]
000808  f7fffffe          BL       yaffs_FindObjectByName
00080c  b148              CBZ      r0,|L1.2082|
;;;1423   			yaffsfs_SetError(-EEXIST); // the name already exists
00080e  f06f0010          MVN      r0,#0x10
000812  f7fffffe          BL       yaffsfs_SetError
;;;1424   			put_str_("yaffs mkdir already exists");
000816  a16f              ADR      r1,|L1.2516|
000818  486c              LDR      r0,|L1.2508|
00081a  4a6d              LDR      r2,|L1.2512|
00081c  6812              LDR      r2,[r2,#0]  ; _db_msg_
00081e  4790              BLX      r2
000820  e003              B        |L1.2090|
                  |L1.2082|
;;;1425   		}
;;;1426   		else
;;;1427   			yaffsfs_SetError(-ENOSPC); // just assume no space
000822  f06f001b          MVN      r0,#0x1b
000826  f7fffffe          BL       yaffsfs_SetError
                  |L1.2090|
;;;1428   		put_str_("yaffs mkdir no space");
00082a  a171              ADR      r1,|L1.2544|
00082c  4867              LDR      r0,|L1.2508|
00082e  4a68              LDR      r2,|L1.2512|
000830  6812              LDR      r2,[r2,#0]  ; _db_msg_
000832  4790              BLX      r2
;;;1429   		retVal = -1;
000834  f04f38ff          MOV      r8,#0xffffffff
                  |L1.2104|
;;;1430           
;;;1431   	}
;;;1432   
;;;1433   	yaffsfs_Unlock();
000838  f7fffffe          BL       yaffsfs_Unlock
;;;1434   
;;;1435   	return retVal;
00083c  4640              MOV      r0,r8
;;;1436   }
00083e  e8bd81fc          POP      {r2-r8,pc}
;;;1437   
                          ENDP

                  yaffs_mount PROC
;;;1438   int yaffs_mount(const YCHAR *path)
000842  b5f8              PUSH     {r3-r7,lr}
;;;1439   {
000844  4606              MOV      r6,r0
;;;1440   	int retVal=-1;
000846  f04f37ff          MOV      r7,#0xffffffff
;;;1441   	int result=YAFFS_FAIL;
00084a  2500              MOVS     r5,#0
;;;1442   	yaffs_Device *dev=NULL;
00084c  2400              MOVS     r4,#0
;;;1443   	YCHAR *dummy;
;;;1444       
;;;1445   	T(YAFFS_TRACE_ALWAYS,(TSTR("yaffs: Mounting %s" TENDSTR),path));
00084e  bf00              NOP      
000850  bf00              NOP      
;;;1446       
;;;1447   	yaffsfs_Lock();
000852  f7fffffe          BL       yaffsfs_Lock
;;;1448   	dev = yaffsfs_FindDevice(path,&dummy);
000856  4669              MOV      r1,sp
000858  4630              MOV      r0,r6
00085a  f7fffffe          BL       yaffsfs_FindDevice
00085e  4604              MOV      r4,r0
;;;1449   	 
;;;1450   	if(dev)
000860  b1bc              CBZ      r4,|L1.2194|
;;;1451   	{
;;;1452   	  		 
;;;1453   		if(!dev->isMounted)
000862  f8d40094          LDR      r0,[r4,#0x94]
000866  b978              CBNZ     r0,|L1.2184|
;;;1454   		{ 
;;;1455   		    
;;;1456   			result = yaffs_GutsInitialise(dev);
000868  4620              MOV      r0,r4
00086a  f7fffffe          BL       yaffs_GutsInitialise
00086e  4605              MOV      r5,r0
;;;1457   		 
;;;1458   			if(result == YAFFS_FAIL)
000870  b91d              CBNZ     r5,|L1.2170|
;;;1459   			{
;;;1460   				// todo error - mount failed
;;;1461   				yaffsfs_SetError(-ENOMEM);
000872  f06f000b          MVN      r0,#0xb
000876  f7fffffe          BL       yaffsfs_SetError
                  |L1.2170|
;;;1462   			}
;;;1463   			retVal = result ? 0 : -1;
00087a  b10d              CBZ      r5,|L1.2176|
00087c  2000              MOVS     r0,#0
00087e  e001              B        |L1.2180|
                  |L1.2176|
000880  f04f30ff          MOV      r0,#0xffffffff
                  |L1.2180|
000884  4607              MOV      r7,r0
000886  e008              B        |L1.2202|
                  |L1.2184|
;;;1464   		}
;;;1465   		else
;;;1466   		{
;;;1467   		 
;;;1468   			//todo error - already mounted.
;;;1469   			yaffsfs_SetError(-EBUSY);
000888  f06f000f          MVN      r0,#0xf
00088c  f7fffffe          BL       yaffsfs_SetError
000890  e003              B        |L1.2202|
                  |L1.2194|
;;;1470   		}
;;;1471   	}
;;;1472   	else
;;;1473   	{
;;;1474   		// todo error - no device
;;;1475    
;;;1476   		yaffsfs_SetError(-ENODEV);
000892  f06f0012          MVN      r0,#0x12
000896  f7fffffe          BL       yaffsfs_SetError
                  |L1.2202|
;;;1477   	}
;;;1478   	yaffsfs_Unlock();
00089a  f7fffffe          BL       yaffsfs_Unlock
;;;1479   	return retVal;
00089e  4638              MOV      r0,r7
;;;1480   
;;;1481   }
0008a0  bdf8              POP      {r3-r7,pc}
;;;1482   
                          ENDP

                  yaffsfs_DirAdvance PROC
;;;1710   
;;;1711   static void yaffsfs_DirAdvance(yaffsfs_DirectorySearchContext *dsc)
0008a2  b510              PUSH     {r4,lr}
;;;1712   {
0008a4  4604              MOV      r4,r0
;;;1713   	if(dsc &&
0008a6  b33c              CBZ      r4,|L1.2296|
;;;1714   	   dsc->dirObj &&
0008a8  f8d40218          LDR      r0,[r4,#0x218]
0008ac  b320              CBZ      r0,|L1.2296|
;;;1715              dsc->dirObj->variantType == YAFFS_OBJECT_TYPE_DIRECTORY){
0008ae  f8d40218          LDR      r0,[r4,#0x218]
0008b2  f8900054          LDRB     r0,[r0,#0x54]
0008b6  2803              CMP      r0,#3
0008b8  d11e              BNE      |L1.2296|
;;;1716   
;;;1717              if( dsc->nextReturn == NULL ||
0008ba  f8d4021c          LDR      r0,[r4,#0x21c]
0008be  b130              CBZ      r0,|L1.2254|
;;;1718                  ylist_empty(&dsc->dirObj->variant.directoryVariant.children)){
0008c0  f8d41218          LDR      r1,[r4,#0x218]
0008c4  f1010058          ADD      r0,r1,#0x58
0008c8  f7fffffe          BL       ylist_empty
0008cc  b118              CBZ      r0,|L1.2262|
                  |L1.2254|
;;;1719                   dsc->nextReturn = NULL;
0008ce  2000              MOVS     r0,#0
0008d0  f8c4021c          STR      r0,[r4,#0x21c]
0008d4  e010              B        |L1.2296|
                  |L1.2262|
;;;1720              } else {
;;;1721                      struct ylist_head *next = dsc->nextReturn->siblings.next;
0008d6  f8d4121c          LDR      r1,[r4,#0x21c]
0008da  6a08              LDR      r0,[r1,#0x20]
;;;1722   
;;;1723                      if( next == &dsc->dirObj->variant.directoryVariant.children)
0008dc  f8d41218          LDR      r1,[r4,#0x218]
0008e0  3158              ADDS     r1,r1,#0x58
0008e2  4281              CMP      r1,r0
0008e4  d103              BNE      |L1.2286|
;;;1724                           dsc->nextReturn = NULL; /* end of list */
0008e6  2100              MOVS     r1,#0
0008e8  f8c4121c          STR      r1,[r4,#0x21c]
0008ec  e003              B        |L1.2294|
                  |L1.2286|
;;;1725                      else
;;;1726                           dsc->nextReturn = ylist_entry(next,yaffs_Object,siblings);
0008ee  f1a00120          SUB      r1,r0,#0x20
0008f2  f8c4121c          STR      r1,[r4,#0x21c]
                  |L1.2294|
;;;1727              }
0008f6  bf00              NOP      
                  |L1.2296|
;;;1728           } else {
;;;1729                   /* Hey someone isn't playing nice! */
;;;1730   	}
;;;1731   }
0008f8  bd10              POP      {r4,pc}
;;;1732   
                          ENDP

                  yaffsfs_RemoveObjectCallback PROC
;;;1733   static void yaffsfs_RemoveObjectCallback(yaffs_Object *obj)
0008fa  b570              PUSH     {r4-r6,lr}
;;;1734   {
0008fc  4606              MOV      r6,r0
;;;1735   
;;;1736           struct ylist_head *i;
;;;1737           yaffsfs_DirectorySearchContext *dsc;
;;;1738   
;;;1739           /* if search contexts not initilised then skip */
;;;1740           if(!search_contexts.next)
0008fe  4842              LDR      r0,|L1.2568|
000900  6800              LDR      r0,[r0,#0]  ; search_contexts
000902  b900              CBNZ     r0,|L1.2310|
                  |L1.2308|
;;;1741                   return;
;;;1742   
;;;1743           /* Iterate through the directory search contexts.
;;;1744            * If any are the one being removed, then advance the dsc to
;;;1745            * the next one to prevent a hanging ptr.
;;;1746            */
;;;1747            ylist_for_each(i, &search_contexts) {
;;;1748                   if (i) {
;;;1749                           dsc = ylist_entry(i, yaffsfs_DirectorySearchContext,others);
;;;1750                           if(dsc->nextReturn == obj)
;;;1751                                   yaffsfs_DirAdvance(dsc);
;;;1752                   }
;;;1753   	}
;;;1754   
;;;1755   }
000904  bd70              POP      {r4-r6,pc}
                  |L1.2310|
000906  4840              LDR      r0,|L1.2568|
000908  6804              LDR      r4,[r0,#0]            ;1747  ; search_contexts
00090a  e00a              B        |L1.2338|
                  |L1.2316|
00090c  b144              CBZ      r4,|L1.2336|
00090e  f5a47509          SUB      r5,r4,#0x224          ;1749
000912  f8d5021c          LDR      r0,[r5,#0x21c]        ;1750
000916  42b0              CMP      r0,r6                 ;1750
000918  d102              BNE      |L1.2336|
00091a  4628              MOV      r0,r5                 ;1751
00091c  f7fffffe          BL       yaffsfs_DirAdvance
                  |L1.2336|
000920  6824              LDR      r4,[r4,#0]            ;1747
                  |L1.2338|
000922  4839              LDR      r0,|L1.2568|
000924  4284              CMP      r4,r0                 ;1747
000926  d1f1              BNE      |L1.2316|
000928  bf00              NOP      
00092a  e7eb              B        |L1.2308|
;;;1756   
                          ENDP

                  yaffs_initialise PROC
;;;1644   
;;;1645   void yaffs_initialise(yaffsfs_DeviceConfiguration *cfgList)
00092c  b570              PUSH     {r4-r6,lr}
;;;1646   {
00092e  4605              MOV      r5,r0
;;;1647   
;;;1648   	yaffsfs_DeviceConfiguration *cfg;
;;;1649   
;;;1650   	yaffsfs_configurationList = cfgList;
000930  4836              LDR      r0,|L1.2572|
000932  6005              STR      r5,[r0,#0]  ; yaffsfs_configurationList
;;;1651   
;;;1652   	yaffsfs_InitHandles();
000934  f7fffffe          BL       yaffsfs_InitHandles
;;;1653   
;;;1654   	cfg = yaffsfs_configurationList;
000938  4834              LDR      r0,|L1.2572|
00093a  6804              LDR      r4,[r0,#0]  ; yaffsfs_configurationList
;;;1655   
;;;1656   	while(cfg && cfg->prefix && cfg->dev)
00093c  e007              B        |L1.2382|
                  |L1.2366|
;;;1657   	{
;;;1658   		cfg->dev->isMounted = 0;
00093e  2000              MOVS     r0,#0
000940  6861              LDR      r1,[r4,#4]
000942  f8c10094          STR      r0,[r1,#0x94]
;;;1659   		cfg->dev->removeObjectCallback = yaffsfs_RemoveObjectCallback;
000946  4832              LDR      r0,|L1.2576|
000948  6861              LDR      r1,[r4,#4]
00094a  6608              STR      r0,[r1,#0x60]
;;;1660   		cfg++;
00094c  3408              ADDS     r4,r4,#8
                  |L1.2382|
00094e  b124              CBZ      r4,|L1.2394|
000950  6820              LDR      r0,[r4,#0]            ;1656
000952  b110              CBZ      r0,|L1.2394|
000954  6860              LDR      r0,[r4,#4]            ;1656
000956  2800              CMP      r0,#0                 ;1656
000958  d1f1              BNE      |L1.2366|
                  |L1.2394|
;;;1661   	}
;;;1662   
;;;1663   
;;;1664   }
00095a  bd70              POP      {r4-r6,pc}
;;;1665   
                          ENDP

                  yaffsfs_SetDirRewound PROC
;;;1691   
;;;1692   static void yaffsfs_SetDirRewound(yaffsfs_DirectorySearchContext *dsc)
00095c  b510              PUSH     {r4,lr}
;;;1693   {
00095e  4604              MOV      r4,r0
;;;1694   	if(dsc &&
000960  b1e4              CBZ      r4,|L1.2460|
;;;1695   	   dsc->dirObj &&
000962  f8d40218          LDR      r0,[r4,#0x218]
000966  b1c8              CBZ      r0,|L1.2460|
;;;1696   	   dsc->dirObj->variantType == YAFFS_OBJECT_TYPE_DIRECTORY){
000968  f8d40218          LDR      r0,[r4,#0x218]
00096c  f8900054          LDRB     r0,[r0,#0x54]
000970  2803              CMP      r0,#3
000972  d113              BNE      |L1.2460|
;;;1697   
;;;1698              dsc->offset = 0;
000974  2000              MOVS     r0,#0
000976  f8c40220          STR      r0,[r4,#0x220]
;;;1699   
;;;1700              if( ylist_empty(&dsc->dirObj->variant.directoryVariant.children)){
00097a  f8d41218          LDR      r1,[r4,#0x218]
00097e  f1010058          ADD      r0,r1,#0x58
000982  f7fffffe          BL       ylist_empty
000986  b118              CBZ      r0,|L1.2448|
;;;1701                   dsc->nextReturn = NULL;
000988  2000              MOVS     r0,#0
00098a  f8c4021c          STR      r0,[r4,#0x21c]
00098e  e005              B        |L1.2460|
                  |L1.2448|
;;;1702              } else {
;;;1703                   dsc->nextReturn = ylist_entry(dsc->dirObj->variant.directoryVariant.children.next,
000990  f8d40218          LDR      r0,[r4,#0x218]
000994  6d80              LDR      r0,[r0,#0x58]
000996  3820              SUBS     r0,r0,#0x20
000998  f8c4021c          STR      r0,[r4,#0x21c]
                  |L1.2460|
;;;1704                                                   yaffs_Object,siblings);
;;;1705              }
;;;1706           } else {
;;;1707   		/* Hey someone isn't playing nice! */
;;;1708   	}
;;;1709   }
00099c  bd10              POP      {r4,pc}
;;;1710   
                          ENDP

                  ylist_empty PROC
;;;110    /* Test if the list is empty */
;;;111    static __inline__ int ylist_empty(struct ylist_head *entry)
00099e  4601              MOV      r1,r0
;;;112    {
;;;113            return (entry->next == entry);
0009a0  6808              LDR      r0,[r1,#0]
0009a2  4288              CMP      r0,r1
0009a4  d101              BNE      |L1.2474|
0009a6  2001              MOVS     r0,#1
                  |L1.2472|
;;;114    }
0009a8  4770              BX       lr
                  |L1.2474|
0009aa  2000              MOVS     r0,#0                 ;113
0009ac  e7fc              B        |L1.2472|
;;;115    
                          ENDP

0009ae  0000              DCW      0x0000
                  |L1.2480|
0009b0  79616666          DCB      "yaffs mkdir missing path",0
0009b4  73206d6b
0009b8  64697220
0009bc  6d697373
0009c0  696e6720
0009c4  70617468
0009c8  00      
0009c9  00                DCB      0
0009ca  00                DCB      0
0009cb  00                DCB      0
                  |L1.2508|
                          DCD      0x4000c000
                  |L1.2512|
                          DCD      _db_msg_
                  |L1.2516|
0009d4  79616666          DCB      "yaffs mkdir already exists",0
0009d8  73206d6b
0009dc  64697220
0009e0  616c7265
0009e4  61647920
0009e8  65786973
0009ec  747300  
0009ef  00                DCB      0
                  |L1.2544|
0009f0  79616666          DCB      "yaffs mkdir no space",0
0009f4  73206d6b
0009f8  64697220
0009fc  6e6f2073
000a00  70616365
000a04  00      
000a05  00                DCB      0
000a06  00                DCB      0
000a07  00                DCB      0
                  |L1.2568|
                          DCD      search_contexts
                  |L1.2572|
                          DCD      yaffsfs_configurationList
                  |L1.2576|
                          DCD      yaffsfs_RemoveObjectCallback

                          AREA ||area_number.2||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.2||, ||.text||
                  yaffs_dup PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4607              MOV      r7,r0
000006  f04f35ff          MOV      r5,#0xffffffff
00000a  2400              MOVS     r4,#0
00000c  2600              MOVS     r6,#0
00000e  f7fffffe          BL       yaffsfs_Lock
000012  4638              MOV      r0,r7
000014  f7fffffe          BL       yaffsfs_GetHandlePointer
000018  4604              MOV      r4,r0
00001a  b134              CBZ      r4,|L2.42|
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  7820              LDRB     r0,[r4,#0]
00001e  f0000001          AND      r0,r0,#1
000022  b110              CBZ      r0,|L2.42|
000024  f7fffffe          BL       yaffsfs_GetHandle
000028  4605              MOV      r5,r0                 ;64
                  |L2.42|
00002a  2d00              CMP      r5,#0                 ;64
00002c  db03              BLT      |L2.54|
;;;68     	}
;;;69     	return 0;
00002e  4628              MOV      r0,r5
;;;70     }
000030  f7fffffe          BL       yaffsfs_GetHandlePointer
000034  4606              MOV      r6,r0
                  |L2.54|
000036  b136              CBZ      r6,|L2.70|
000038  e8940007          LDM      r4,{r0-r2}
00003c  e8860007          STM      r6,{r0-r2}
000040  4628              MOV      r0,r5
                  |L2.66|
000042  e8bd81f0          POP      {r4-r8,pc}
                  |L2.70|
000046  b924              CBNZ     r4,|L2.82|
000048  f06f0008          MVN      r0,#8
00004c  f7fffffe          BL       yaffsfs_SetError
000050  e003              B        |L2.90|
                  |L2.82|
000052  f06f000b          MVN      r0,#0xb
000056  f7fffffe          BL       yaffsfs_SetError
                  |L2.90|
00005a  f04f30ff          MOV      r0,#0xffffffff
00005e  e7f0              B        |L2.66|
;;;71     
                          ENDP


                          AREA ||area_number.3||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.3||, ||.text||
                  yaffs_flush PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4605              MOV      r5,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  2400              MOVS     r4,#0
000006  2600              MOVS     r6,#0
000008  f7fffffe          BL       yaffsfs_Lock
00000c  4628              MOV      r0,r5
00000e  f7fffffe          BL       yaffsfs_GetHandlePointer
000012  4604              MOV      r4,r0
000014  b144              CBZ      r4,|L3.40|
000016  7820              LDRB     r0,[r4,#0]
000018  f0000001          AND      r0,r0,#1
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  b120              CBZ      r0,|L3.40|
00001e  2101              MOVS     r1,#1
000020  68a0              LDR      r0,[r4,#8]
000022  f7fffffe          BL       yaffs_FlushFile
000026  e005              B        |L3.52|
                  |L3.40|
000028  f06f0008          MVN      r0,#8                 ;64
00002c  f7fffffe          BL       yaffsfs_SetError
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  f04f36ff          MOV      r6,#0xffffffff
                  |L3.52|
000034  f7fffffe          BL       yaffsfs_Unlock
000038  4630              MOV      r0,r6
00003a  bd70              POP      {r4-r6,pc}
;;;71     
                          ENDP


                          AREA ||area_number.4||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.4||, ||.text||
                  yaffs_read PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d5ff0          PUSH     {r4-r12,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4682              MOV      r10,r0
000006  468b              MOV      r11,r1
000008  4614              MOV      r4,r2
00000a  2500              MOVS     r5,#0
00000c  46a8              MOV      r8,r5
00000e  2600              MOVS     r6,#0
000010  f04f39ff          MOV      r9,#0xffffffff
000014  f7fffffe          BL       yaffsfs_Lock
000018  4650              MOV      r0,r10
00001a  f7fffffe          BL       yaffsfs_GetHandlePointer
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  4605              MOV      r5,r0
000020  4650              MOV      r0,r10
000022  f7fffffe          BL       yaffsfs_GetHandleObject
000026  4680              MOV      r8,r0
000028  b115              CBZ      r5,|L4.48|
00002a  f1b80f00          CMP      r8,#0                 ;64
;;;68     	}
;;;69     	return 0;
00002e  d104              BNE      |L4.58|
                  |L4.48|
;;;70     }
000030  f06f0008          MVN      r0,#8
000034  f7fffffe          BL       yaffsfs_SetError
000038  e023              B        |L4.130|
                  |L4.58|
00003a  b1fd              CBZ      r5,|L4.124|
00003c  f1b80f00          CMP      r8,#0
000040  d01f              BEQ      |L4.130|
000042  686e              LDR      r6,[r5,#4]
000044  4640              MOV      r0,r8
000046  f7fffffe          BL       yaffs_GetObjectFileLength
00004a  42b0              CMP      r0,r6
00004c  dd04              BLE      |L4.88|
00004e  4640              MOV      r0,r8
000050  f7fffffe          BL       yaffs_GetObjectFileLength
000054  1b87              SUBS     r7,r0,r6
000056  e000              B        |L4.90|
                  |L4.88|
000058  2700              MOVS     r7,#0
                  |L4.90|
00005a  42bc              CMP      r4,r7
00005c  d900              BLS      |L4.96|
00005e  463c              MOV      r4,r7
                  |L4.96|
000060  b16c              CBZ      r4,|L4.126|
000062  4623              MOV      r3,r4
000064  4632              MOV      r2,r6
000066  4659              MOV      r1,r11
000068  4640              MOV      r0,r8
00006a  f7fffffe          BL       yaffs_ReadDataFromFile
00006e  4681              MOV      r9,r0
000070  f1b90f00          CMP      r9,#0
000074  db05              BLT      |L4.130|
000076  eb060009          ADD      r0,r6,r9
00007a  6068              STR      r0,[r5,#4]
                  |L4.124|
00007c  e001              B        |L4.130|
                  |L4.126|
00007e  f04f0900          MOV      r9,#0
                  |L4.130|
000082  f7fffffe          BL       yaffsfs_Unlock
000086  f1b90f00          CMP      r9,#0
00008a  db02              BLT      |L4.146|
00008c  4648              MOV      r0,r9
                  |L4.142|
00008e  e8bd9ff0          POP      {r4-r12,pc}
                  |L4.146|
000092  f04f30ff          MOV      r0,#0xffffffff
000096  e7fa              B        |L4.142|
;;;71     
                          ENDP


                          AREA ||area_number.5||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.5||, ||.text||
                  yaffs_pwrite PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4681              MOV      r9,r0
000006  468a              MOV      r10,r1
000008  4616              MOV      r6,r2
00000a  4698              MOV      r8,r3
00000c  2400              MOVS     r4,#0
00000e  2500              MOVS     r5,#0
000010  2000              MOVS     r0,#0
000012  9001              STR      r0,[sp,#4]
000014  1e47              SUBS     r7,r0,#1
000016  4683              MOV      r11,r0
000018  f7fffffe          BL       yaffsfs_Lock
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4648              MOV      r0,r9
00001e  f7fffffe          BL       yaffsfs_GetHandlePointer
000022  4604              MOV      r4,r0
000024  4648              MOV      r0,r9
000026  f7fffffe          BL       yaffsfs_GetHandleObject
00002a  4605              MOV      r5,r0                 ;64
00002c  b104              CBZ      r4,|L5.48|
;;;68     	}
;;;69     	return 0;
00002e  b925              CBNZ     r5,|L5.58|
                  |L5.48|
;;;70     }
000030  f06f0008          MVN      r0,#8
000034  f7fffffe          BL       yaffsfs_SetError
000038  e01a              B        |L5.112|
                  |L5.58|
00003a  b124              CBZ      r4,|L5.70|
00003c  b11d              CBZ      r5,|L5.70|
00003e  7820              LDRB     r0,[r4,#0]
000040  f3c00040          UBFX     r0,r0,#1,#1
000044  b9a0              CBNZ     r0,|L5.112|
                  |L5.70|
000046  b19c              CBZ      r4,|L5.112|
000048  b195              CBZ      r5,|L5.112|
00004a  f8cd8004          STR      r8,[sp,#4]
00004e  4633              MOV      r3,r6
000050  f8cdb000          STR      r11,[sp,#0]
000054  4651              MOV      r1,r10
000056  4628              MOV      r0,r5
000058  9a01              LDR      r2,[sp,#4]
00005a  f7fffffe          BL       yaffs_WriteDataToFile
00005e  4607              MOV      r7,r0
000060  2f00              CMP      r7,#0
000062  db01              BLT      |L5.104|
000064  42b7              CMP      r7,r6
000066  d203              BCS      |L5.112|
                  |L5.104|
000068  f06f001b          MVN      r0,#0x1b
00006c  f7fffffe          BL       yaffsfs_SetError
                  |L5.112|
000070  f7fffffe          BL       yaffsfs_Unlock
000074  2f00              CMP      r7,#0
000076  db02              BLT      |L5.126|
000078  4638              MOV      r0,r7
                  |L5.122|
00007a  e8bd9ffc          POP      {r2-r12,pc}
                  |L5.126|
00007e  f04f30ff          MOV      r0,#0xffffffff
000082  e7fa              B        |L5.122|
;;;71     
                          ENDP


                          AREA ||area_number.6||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.6||, ||.text||
                  yaffs_truncate PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  2400              MOVS     r4,#0
00000a  2700              MOVS     r7,#0
00000c  f7fffffe          BL       yaffsfs_Lock
000010  2200              MOVS     r2,#0
000012  4629              MOV      r1,r5
000014  4610              MOV      r0,r2
000016  f7fffffe          BL       yaffsfs_FindObject
00001a  4604              MOV      r4,r0
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  b11c              CBZ      r4,|L6.38|
00001e  4620              MOV      r0,r4
000020  f7fffffe          BL       yaffs_GetEquivalentObject
000024  4604              MOV      r4,r0
                  |L6.38|
000026  b924              CBNZ     r4,|L6.50|
000028  f06f0001          MVN      r0,#1                 ;64
00002c  f7fffffe          BL       yaffsfs_SetError
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  e00d              B        |L6.78|
                  |L6.50|
000032  f8940054          LDRB     r0,[r4,#0x54]
000036  2801              CMP      r0,#1
000038  d004              BEQ      |L6.68|
00003a  f06f0014          MVN      r0,#0x14
00003e  f7fffffe          BL       yaffsfs_SetError
000042  e004              B        |L6.78|
                  |L6.68|
000044  4631              MOV      r1,r6
000046  4620              MOV      r0,r4
000048  f7fffffe          BL       yaffs_ResizeFile
00004c  4607              MOV      r7,r0
                  |L6.78|
00004e  f7fffffe          BL       yaffsfs_Unlock
000052  b117              CBZ      r7,|L6.90|
000054  2000              MOVS     r0,#0
                  |L6.86|
000056  e8bd81f0          POP      {r4-r8,pc}
                  |L6.90|
00005a  f04f30ff          MOV      r0,#0xffffffff
00005e  e7fa              B        |L6.86|
;;;71     
                          ENDP


                          AREA ||area_number.7||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.7||, ||.text||
                  yaffs_ftruncate PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  2700              MOVS     r7,#0
00000a  2400              MOVS     r4,#0
00000c  46a0              MOV      r8,r4
00000e  f7fffffe          BL       yaffsfs_Lock
000012  4628              MOV      r0,r5
000014  f7fffffe          BL       yaffsfs_GetHandlePointer
000018  4607              MOV      r7,r0
00001a  4628              MOV      r0,r5
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  f7fffffe          BL       yaffsfs_GetHandleObject
000020  4604              MOV      r4,r0
000022  b107              CBZ      r7,|L7.38|
000024  b924              CBNZ     r4,|L7.48|
                  |L7.38|
000026  f06f0008          MVN      r0,#8
00002a  f7fffffe          BL       yaffsfs_SetError
;;;68     	}
;;;69     	return 0;
00002e  e004              B        |L7.58|
                  |L7.48|
;;;70     }
000030  4631              MOV      r1,r6
000032  4620              MOV      r0,r4
000034  f7fffffe          BL       yaffs_ResizeFile
000038  4680              MOV      r8,r0
                  |L7.58|
00003a  f7fffffe          BL       yaffsfs_Unlock
00003e  f1b80f00          CMP      r8,#0
000042  d002              BEQ      |L7.74|
000044  2000              MOVS     r0,#0
                  |L7.70|
000046  e8bd81f0          POP      {r4-r8,pc}
                  |L7.74|
00004a  f04f30ff          MOV      r0,#0xffffffff
00004e  e7fa              B        |L7.70|
;;;71     
                          ENDP


                          AREA ||area_number.8||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.8||, ||.text||
                  yaffs_lseek PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4682              MOV      r10,r0
000006  460c              MOV      r4,r1
000008  4615              MOV      r5,r2
00000a  2600              MOVS     r6,#0
00000c  46b1              MOV      r9,r6
00000e  1e77              SUBS     r7,r6,#1
000010  f04f38ff          MOV      r8,#0xffffffff
000014  f7fffffe          BL       yaffsfs_Lock
000018  4650              MOV      r0,r10
00001a  f7fffffe          BL       yaffsfs_GetHandlePointer
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  4606              MOV      r6,r0
000020  4650              MOV      r0,r10
000022  f7fffffe          BL       yaffsfs_GetHandleObject
000026  4681              MOV      r9,r0
000028  b116              CBZ      r6,|L8.48|
00002a  f1b90f00          CMP      r9,#0                 ;64
;;;68     	}
;;;69     	return 0;
00002e  d104              BNE      |L8.58|
                  |L8.48|
;;;70     }
000030  f06f0008          MVN      r0,#8
000034  f7fffffe          BL       yaffsfs_SetError
000038  e018              B        |L8.108|
                  |L8.58|
00003a  b91d              CBNZ     r5,|L8.68|
00003c  2c00              CMP      r4,#0
00003e  db15              BLT      |L8.108|
000040  4627              MOV      r7,r4
000042  e013              B        |L8.108|
                  |L8.68|
000044  2d01              CMP      r5,#1
000046  d102              BNE      |L8.78|
000048  6870              LDR      r0,[r6,#4]
00004a  1907              ADDS     r7,r0,r4
00004c  e00e              B        |L8.108|
                  |L8.78|
00004e  2d02              CMP      r5,#2
000050  d10c              BNE      |L8.108|
000052  4648              MOV      r0,r9
000054  f7fffffe          BL       yaffs_GetObjectFileLength
000058  4680              MOV      r8,r0
00005a  f1b80f00          CMP      r8,#0
00005e  db05              BLT      |L8.108|
000060  eb080004          ADD      r0,r8,r4
000064  2800              CMP      r0,#0
000066  db01              BLT      |L8.108|
000068  eb080704          ADD      r7,r8,r4
                  |L8.108|
00006c  2f00              CMP      r7,#0
00006e  db00              BLT      |L8.114|
000070  6077              STR      r7,[r6,#4]
                  |L8.114|
000072  f7fffffe          BL       yaffsfs_Unlock
000076  4638              MOV      r0,r7
000078  e8bd87f0          POP      {r4-r10,pc}
;;;71     
                          ENDP


                          AREA ||area_number.9||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.9||, ||.text||
                  yaffsfs_DoUnlink PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d43f8          PUSH     {r3-r9,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4606              MOV      r6,r0
000006  460c              MOV      r4,r1
000008  2700              MOVS     r7,#0
00000a  2500              MOVS     r5,#0
00000c  46a8              MOV      r8,r5
00000e  f7fffffe          BL       yaffsfs_Lock
000012  2200              MOVS     r2,#0
000014  4631              MOV      r1,r6
000016  4610              MOV      r0,r2
000018  f7fffffe          BL       yaffsfs_FindObject
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4605              MOV      r5,r0
00001e  2300              MOVS     r3,#0
000020  466a              MOV      r2,sp
000022  4631              MOV      r1,r6
000024  4618              MOV      r0,r3
000026  f7fffffe          BL       yaffsfs_FindDirectory
00002a  4607              MOV      r7,r0                 ;64
00002c  b927              CBNZ     r7,|L9.56|
;;;68     	}
;;;69     	return 0;
00002e  f06f0013          MVN      r0,#0x13
;;;70     }
000032  f7fffffe          BL       yaffsfs_SetError
000036  e026              B        |L9.134|
                  |L9.56|
000038  b925              CBNZ     r5,|L9.68|
00003a  f06f0001          MVN      r0,#1
00003e  f7fffffe          BL       yaffsfs_SetError
000042  e020              B        |L9.134|
                  |L9.68|
000044  b944              CBNZ     r4,|L9.88|
000046  f8950054          LDRB     r0,[r5,#0x54]
00004a  2803              CMP      r0,#3
00004c  d104              BNE      |L9.88|
00004e  f06f0014          MVN      r0,#0x14
000052  f7fffffe          BL       yaffsfs_SetError
000056  e016              B        |L9.134|
                  |L9.88|
000058  b144              CBZ      r4,|L9.108|
00005a  f8950054          LDRB     r0,[r5,#0x54]
00005e  2803              CMP      r0,#3
000060  d004              BEQ      |L9.108|
000062  f06f0013          MVN      r0,#0x13
000066  f7fffffe          BL       yaffsfs_SetError
00006a  e00c              B        |L9.134|
                  |L9.108|
00006c  4638              MOV      r0,r7
00006e  9900              LDR      r1,[sp,#0]
000070  f7fffffe          BL       yaffs_Unlink
000074  4680              MOV      r8,r0
000076  f1b80f00          CMP      r8,#0
00007a  d104              BNE      |L9.134|
00007c  b11c              CBZ      r4,|L9.134|
00007e  f06f0026          MVN      r0,#0x26
000082  f7fffffe          BL       yaffsfs_SetError
                  |L9.134|
000086  f7fffffe          BL       yaffsfs_Unlock
00008a  f1b80f00          CMP      r8,#0
00008e  d103              BNE      |L9.152|
000090  f04f30ff          MOV      r0,#0xffffffff
                  |L9.148|
000094  e8bd83f8          POP      {r3-r9,pc}
                  |L9.152|
000098  2000              MOVS     r0,#0
00009a  e7fb              B        |L9.148|
;;;71     
                          ENDP


                          AREA ||area_number.10||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.10||, ||.text||
                  yaffs_rmdir PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b510              PUSH     {r4,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  2101              MOVS     r1,#1
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       yaffsfs_DoUnlink
00000c  bd10              POP      {r4,pc}
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.11||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.11||, ||.text||
                  yaffs_unlink PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b510              PUSH     {r4,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  2100              MOVS     r1,#0
000006  4620              MOV      r0,r4
000008  f7fffffe          BL       yaffsfs_DoUnlink
00000c  bd10              POP      {r4,pc}
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.12||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.12||, ||.text||
                  yaffs_rename PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4681              MOV      r9,r0
000006  468a              MOV      r10,r1
000008  2600              MOVS     r6,#0
00000a  2400              MOVS     r4,#0
00000c  2500              MOVS     r5,#0
00000e  46a3              MOV      r11,r4
000010  2701              MOVS     r7,#1
000012  f7fffffe          BL       yaffsfs_Lock
000016  2300              MOVS     r3,#0
000018  aa01              ADD      r2,sp,#4
00001a  4649              MOV      r1,r9
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4618              MOV      r0,r3
00001e  f7fffffe          BL       yaffsfs_FindDirectory
000022  4606              MOV      r6,r0
000024  2300              MOVS     r3,#0
000026  466a              MOV      r2,sp
000028  4651              MOV      r1,r10                ;64
00002a  4618              MOV      r0,r3                 ;64
00002c  f7fffffe          BL       yaffsfs_FindDirectory
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  4604              MOV      r4,r0
000032  2200              MOVS     r2,#0
000034  4649              MOV      r1,r9
000036  4610              MOV      r0,r2
000038  f7fffffe          BL       yaffsfs_FindObject
00003c  4605              MOV      r5,r0
00003e  b10e              CBZ      r6,|L12.68|
000040  b104              CBZ      r4,|L12.68|
000042  b92d              CBNZ     r5,|L12.80|
                  |L12.68|
000044  f06f0008          MVN      r0,#8
000048  f7fffffe          BL       yaffsfs_SetError
00004c  2700              MOVS     r7,#0
00004e  e01f              B        |L12.144|
                  |L12.80|
000050  68b0              LDR      r0,[r6,#8]
000052  68a1              LDR      r1,[r4,#8]
000054  4288              CMP      r0,r1
000056  d005              BEQ      |L12.100|
000058  f06f0011          MVN      r0,#0x11
00005c  f7fffffe          BL       yaffsfs_SetError
000060  2700              MOVS     r7,#0
000062  e015              B        |L12.144|
                  |L12.100|
000064  b1a5              CBZ      r5,|L12.144|
000066  f8950054          LDRB     r0,[r5,#0x54]
00006a  2803              CMP      r0,#3
00006c  d110              BNE      |L12.144|
00006e  46a0              MOV      r8,r4
000070  e004              B        |L12.124|
                  |L12.114|
000072  45a8              CMP      r8,r5
000074  d100              BNE      |L12.120|
000076  2700              MOVS     r7,#0
                  |L12.120|
000078  f8d8801c          LDR      r8,[r8,#0x1c]
                  |L12.124|
00007c  b117              CBZ      r7,|L12.132|
00007e  f1b80f00          CMP      r8,#0
000082  d1f6              BNE      |L12.114|
                  |L12.132|
000084  b91f              CBNZ     r7,|L12.142|
000086  f06f000c          MVN      r0,#0xc
00008a  f7fffffe          BL       yaffsfs_SetError
                  |L12.142|
00008e  bf00              NOP      
                  |L12.144|
000090  b137              CBZ      r7,|L12.160|
000092  4622              MOV      r2,r4
000094  4630              MOV      r0,r6
000096  e9dd3100          LDRD     r3,r1,[sp,#0]
00009a  f7fffffe          BL       yaffs_RenameObject
00009e  4683              MOV      r11,r0
                  |L12.160|
0000a0  f7fffffe          BL       yaffsfs_Unlock
0000a4  f1bb0f00          CMP      r11,#0
0000a8  d103              BNE      |L12.178|
0000aa  f04f30ff          MOV      r0,#0xffffffff
                  |L12.174|
0000ae  e8bd9ffc          POP      {r2-r12,pc}
                  |L12.178|
0000b2  2000              MOVS     r0,#0
0000b4  e7fb              B        |L12.174|
;;;71     
                          ENDP


                          AREA ||area_number.13||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.13||, ||.text||
                  yaffs_stat PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  460d              MOV      r5,r1
000006  2200              MOVS     r2,#0
000008  4629              MOV      r1,r5
00000a  4620              MOV      r0,r4
00000c  f7fffffe          BL       yaffsfs_DoStatOrLStat
000010  bd70              POP      {r4-r6,pc}
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.14||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.14||, ||.text||
                  yaffs_lstat PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  460d              MOV      r5,r1
000006  2201              MOVS     r2,#1
000008  4629              MOV      r1,r5
00000a  4620              MOV      r0,r4
00000c  f7fffffe          BL       yaffsfs_DoStatOrLStat
000010  bd70              POP      {r4-r6,pc}
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.15||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.15||, ||.text||
                  yaffs_fstat PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  f04f37ff          MOV      r7,#0xffffffff
00000c  f7fffffe          BL       yaffsfs_Lock
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       yaffsfs_GetHandleObject
000016  4604              MOV      r4,r0
000018  b12c              CBZ      r4,|L15.38|
00001a  4631              MOV      r1,r6
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4620              MOV      r0,r4
00001e  f7fffffe          BL       yaffsfs_DoStat
000022  4607              MOV      r7,r0
000024  e003              B        |L15.46|
                  |L15.38|
000026  f06f0008          MVN      r0,#8
00002a  f7fffffe          BL       yaffsfs_SetError
                  |L15.46|
;;;68     	}
;;;69     	return 0;
00002e  f7fffffe          BL       yaffsfs_Unlock
;;;70     }
000032  4638              MOV      r0,r7
000034  e8bd81f0          POP      {r4-r8,pc}
;;;71     
                          ENDP


                          AREA ||area_number.16||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.16||, ||.text||
                  yaffs_access PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4606              MOV      r6,r0
000006  460c              MOV      r4,r1
000008  2700              MOVS     r7,#0
00000a  f7fffffe          BL       yaffsfs_Lock
00000e  2200              MOVS     r2,#0
000010  4631              MOV      r1,r6
000012  4610              MOV      r0,r2
000014  f7fffffe          BL       yaffsfs_FindObject
000018  4605              MOV      r5,r0
00001a  b33d              CBZ      r5,|L16.108|
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  f04f0801          MOV      r8,#1
000020  f0040004          AND      r0,r4,#4
000024  b120              CBZ      r0,|L16.48|
000026  8ea8              LDRH     r0,[r5,#0x34]
000028  f4007080          AND      r0,r0,#0x100          ;64
00002c  b900              CBNZ     r0,|L16.48|
;;;68     	}
;;;69     	return 0;
00002e  46b8              MOV      r8,r7
                  |L16.48|
;;;70     }
000030  f0040002          AND      r0,r4,#2
000034  b130              CBZ      r0,|L16.68|
000036  f8950034          LDRB     r0,[r5,#0x34]
00003a  f0000080          AND      r0,r0,#0x80
00003e  b908              CBNZ     r0,|L16.68|
000040  f04f0800          MOV      r8,#0
                  |L16.68|
000044  f0040001          AND      r0,r4,#1
000048  b130              CBZ      r0,|L16.88|
00004a  f8950034          LDRB     r0,[r5,#0x34]
00004e  f0000040          AND      r0,r0,#0x40
000052  b908              CBNZ     r0,|L16.88|
000054  f04f0800          MOV      r8,#0
                  |L16.88|
000058  f1b80f00          CMP      r8,#0
00005c  d105              BNE      |L16.106|
00005e  f06f000c          MVN      r0,#0xc
000062  f7fffffe          BL       yaffsfs_SetError
000066  f04f37ff          MOV      r7,#0xffffffff
                  |L16.106|
00006a  e005              B        |L16.120|
                  |L16.108|
00006c  f06f0001          MVN      r0,#1
000070  f7fffffe          BL       yaffsfs_SetError
000074  f04f37ff          MOV      r7,#0xffffffff
                  |L16.120|
000078  f7fffffe          BL       yaffsfs_Unlock
00007c  4638              MOV      r0,r7
00007e  e8bd81f0          POP      {r4-r8,pc}
;;;71     
                          ENDP


                          AREA ||area_number.17||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.17||, ||.text||
                  yaffs_chmod PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
000008  f04f37ff          MOV      r7,#0xffffffff
00000c  f7fffffe          BL       yaffsfs_Lock
000010  2200              MOVS     r2,#0
000012  4621              MOV      r1,r4
000014  4610              MOV      r0,r2
000016  f7fffffe          BL       yaffsfs_FindObject
00001a  4605              MOV      r5,r0
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  b12d              CBZ      r5,|L17.42|
00001e  4631              MOV      r1,r6
000020  4628              MOV      r0,r5
000022  f7fffffe          BL       yaffsfs_DoChMod
000026  4607              MOV      r7,r0
000028  e003              B        |L17.50|
                  |L17.42|
00002a  f06f0001          MVN      r0,#1                 ;64
;;;68     	}
;;;69     	return 0;
00002e  f7fffffe          BL       yaffsfs_SetError
                  |L17.50|
;;;70     }
000032  f7fffffe          BL       yaffsfs_Unlock
000036  4638              MOV      r0,r7
000038  e8bd81f0          POP      {r4-r8,pc}
;;;71     
                          ENDP


                          AREA ||area_number.18||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.18||, ||.text||
                  yaffs_fchmod PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  f04f37ff          MOV      r7,#0xffffffff
00000c  f7fffffe          BL       yaffsfs_Lock
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       yaffsfs_GetHandleObject
000016  4604              MOV      r4,r0
000018  b12c              CBZ      r4,|L18.38|
00001a  4631              MOV      r1,r6
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4620              MOV      r0,r4
00001e  f7fffffe          BL       yaffsfs_DoChMod
000022  4607              MOV      r7,r0
000024  e003              B        |L18.46|
                  |L18.38|
000026  f06f0008          MVN      r0,#8
00002a  f7fffffe          BL       yaffsfs_SetError
                  |L18.46|
;;;68     	}
;;;69     	return 0;
00002e  f7fffffe          BL       yaffsfs_Unlock
;;;70     }
000032  4638              MOV      r0,r7
000034  e8bd81f0          POP      {r4-r8,pc}
;;;71     
                          ENDP


                          AREA ||area_number.19||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.19||, ||.text||
                  yaffs_sync PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4605              MOV      r5,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  f04f36ff          MOV      r6,#0xffffffff
000008  2400              MOVS     r4,#0
00000a  f7fffffe          BL       yaffsfs_Lock
00000e  4669              MOV      r1,sp
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       yaffsfs_FindDevice
000016  4604              MOV      r4,r0
000018  b174              CBZ      r4,|L19.56|
00001a  f8d40094          LDR      r0,[r4,#0x94]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  b130              CBZ      r0,|L19.46|
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       yaffs_FlushEntireDeviceCache
000026  4620              MOV      r0,r4
000028  f7fffffe          BL       yaffs_CheckpointSave
00002c  e008              B        |L19.64|
                  |L19.46|
;;;68     	}
;;;69     	return 0;
00002e  f06f0015          MVN      r0,#0x15
;;;70     }
000032  f7fffffe          BL       yaffsfs_SetError
000036  e003              B        |L19.64|
                  |L19.56|
000038  f06f0012          MVN      r0,#0x12
00003c  f7fffffe          BL       yaffsfs_SetError
                  |L19.64|
000040  f7fffffe          BL       yaffsfs_Unlock
000044  4630              MOV      r0,r6
000046  bdf8              POP      {r3-r7,pc}
;;;71     
                          ENDP


                          AREA ||area_number.20||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.20||, ||.text||
                  yaffs_unmount PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d43f8          PUSH     {r3-r9,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4607              MOV      r7,r0
000006  f04f38ff          MOV      r8,#0xffffffff
00000a  2400              MOVS     r4,#0
00000c  f7fffffe          BL       yaffsfs_Lock
000010  4669              MOV      r1,sp
000012  4638              MOV      r0,r7
000014  f7fffffe          BL       yaffsfs_FindDevice
000018  4604              MOV      r4,r0
00001a  b374              CBZ      r4,|L20.122|
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  f8d40094          LDR      r0,[r4,#0x94]
000020  b360              CBZ      r0,|L20.124|
000022  4620              MOV      r0,r4
000024  f7fffffe          BL       yaffs_FlushEntireDeviceCache
000028  4620              MOV      r0,r4                 ;64
00002a  f7fffffe          BL       yaffs_CheckpointSave
;;;68     	}
;;;69     	return 0;
00002e  2000              MOVS     r0,#0
;;;70     }
000030  4606              MOV      r6,r0
000032  4605              MOV      r5,r0
000034  e011              B        |L20.90|
                  |L20.54|
000036  eb050045          ADD      r0,r5,r5,LSL #1
00003a  4918              LDR      r1,|L20.156|
00003c  f8110020          LDRB     r0,[r1,r0,LSL #2]
000040  f0000001          AND      r0,r0,#1
000044  b140              CBZ      r0,|L20.88|
000046  eb050045          ADD      r0,r5,r5,LSL #1
00004a  eb010080          ADD      r0,r1,r0,LSL #2
00004e  6880              LDR      r0,[r0,#8]
000050  6880              LDR      r0,[r0,#8]
000052  42a0              CMP      r0,r4
000054  d100              BNE      |L20.88|
000056  2601              MOVS     r6,#1
                  |L20.88|
000058  1c6d              ADDS     r5,r5,#1
                  |L20.90|
00005a  2dc8              CMP      r5,#0xc8
00005c  da01              BGE      |L20.98|
00005e  2e00              CMP      r6,#0
000060  d0e9              BEQ      |L20.54|
                  |L20.98|
000062  b92e              CBNZ     r6,|L20.112|
000064  4620              MOV      r0,r4
000066  f7fffffe          BL       yaffs_Deinitialise
00006a  f04f0800          MOV      r8,#0
00006e  e003              B        |L20.120|
                  |L20.112|
000070  f06f000f          MVN      r0,#0xf
000074  f7fffffe          BL       yaffsfs_SetError
                  |L20.120|
000078  e00a              B        |L20.144|
                  |L20.122|
00007a  e005              B        |L20.136|
                  |L20.124|
00007c  e7ff              B        |L20.126|
                  |L20.126|
00007e  f06f0015          MVN      r0,#0x15
000082  f7fffffe          BL       yaffsfs_SetError
000086  e003              B        |L20.144|
                  |L20.136|
000088  f06f0012          MVN      r0,#0x12
00008c  f7fffffe          BL       yaffsfs_SetError
                  |L20.144|
000090  f7fffffe          BL       yaffsfs_Unlock
000094  4640              MOV      r0,r8
000096  e8bd83f8          POP      {r3-r9,pc}
;;;71     
                          ENDP

00009a  0000              DCW      0x0000
                  |L20.156|
                          DCD      yaffsfs_handle

                          AREA ||area_number.21||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.21||, ||.text||
                  yaffs_freespace PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4606              MOV      r6,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  f04f35ff          MOV      r5,#0xffffffff
000008  2400              MOVS     r4,#0
00000a  f7fffffe          BL       yaffsfs_Lock
00000e  4669              MOV      r1,sp
000010  4630              MOV      r0,r6
000012  f7fffffe          BL       yaffsfs_FindDevice
000016  4604              MOV      r4,r0
000018  b14c              CBZ      r4,|L21.46|
00001a  f8d40094          LDR      r0,[r4,#0x94]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  b130              CBZ      r0,|L21.46|
000020  4620              MOV      r0,r4
000022  f7fffffe          BL       yaffs_GetNumberOfFreeChunks
000026  4605              MOV      r5,r0
000028  68e0              LDR      r0,[r4,#0xc]          ;64
00002a  4345              MULS     r5,r0,r5              ;64
00002c  e003              B        |L21.54|
                  |L21.46|
;;;68     	}
;;;69     	return 0;
00002e  f06f0015          MVN      r0,#0x15
;;;70     }
000032  f7fffffe          BL       yaffsfs_SetError
                  |L21.54|
000036  f7fffffe          BL       yaffsfs_Unlock
00003a  4628              MOV      r0,r5
00003c  bdf8              POP      {r3-r7,pc}
;;;71     
                          ENDP


                          AREA ||area_number.22||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.22||, ||.text||
                  yaffs_totalspace PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4606              MOV      r6,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  f04f35ff          MOV      r5,#0xffffffff
000008  2400              MOVS     r4,#0
00000a  f7fffffe          BL       yaffsfs_Lock
00000e  4669              MOV      r1,sp
000010  4630              MOV      r0,r6
000012  f7fffffe          BL       yaffsfs_FindDevice
000016  4604              MOV      r4,r0
000018  b16c              CBZ      r4,|L22.54|
00001a  f8d40094          LDR      r0,[r4,#0x94]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  b150              CBZ      r0,|L22.54|
000020  e9d41006          LDRD     r1,r0,[r4,#0x18]
000024  1a40              SUBS     r0,r0,r1
000026  1c40              ADDS     r0,r0,#1
000028  6a21              LDR      r1,[r4,#0x20]         ;64
00002a  1a45              SUBS     r5,r0,r1              ;64
00002c  6920              LDR      r0,[r4,#0x10]         ;64
;;;68     	}
;;;69     	return 0;
00002e  4345              MULS     r5,r0,r5
;;;70     }
000030  68e0              LDR      r0,[r4,#0xc]
000032  4345              MULS     r5,r0,r5
000034  e003              B        |L22.62|
                  |L22.54|
000036  f06f0015          MVN      r0,#0x15
00003a  f7fffffe          BL       yaffsfs_SetError
                  |L22.62|
00003e  f7fffffe          BL       yaffsfs_Unlock
000042  4628              MOV      r0,r5
000044  bdf8              POP      {r3-r7,pc}
;;;71     
                          ENDP


                          AREA ||area_number.23||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.23||, ||.text||
                  yaffs_inodecount PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4605              MOV      r5,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  f04f36ff          MOV      r6,#0xffffffff
000008  2400              MOVS     r4,#0
00000a  f7fffffe          BL       yaffsfs_Lock
00000e  4669              MOV      r1,sp
000010  4628              MOV      r0,r5
000012  f7fffffe          BL       yaffsfs_FindDevice
000016  4604              MOV      r4,r0
000018  b17c              CBZ      r4,|L23.58|
00001a  f8d40094          LDR      r0,[r4,#0x94]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  b160              CBZ      r0,|L23.58|
000020  f8d42128          LDR      r2,[r4,#0x128]
000024  f8d41120          LDR      r1,[r4,#0x120]
000028  1a88              SUBS     r0,r1,r2              ;64
00002a  f8d4112c          LDR      r1,[r4,#0x12c]        ;64
;;;68     	}
;;;69     	return 0;
00002e  4281              CMP      r1,r0
;;;70     }
000030  da02              BGE      |L23.56|
000032  f8d4112c          LDR      r1,[r4,#0x12c]
000036  1a46              SUBS     r6,r0,r1
                  |L23.56|
000038  bf00              NOP      
                  |L23.58|
00003a  bf00              NOP      
00003c  f7fffffe          BL       yaffsfs_Unlock
000040  4630              MOV      r0,r6
000042  bdf8              POP      {r3-r7,pc}
;;;71     
                          ENDP


                          AREA ||area_number.24||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.24||, ||.text||
                  yaffs_opendir PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4606              MOV      r6,r0
000006  2700              MOVS     r7,#0
000008  2500              MOVS     r5,#0
00000a  2400              MOVS     r4,#0
00000c  f7fffffe          BL       yaffsfs_Lock
000010  2200              MOVS     r2,#0
000012  4631              MOV      r1,r6
000014  4610              MOV      r0,r2
000016  f7fffffe          BL       yaffsfs_FindObject
00001a  4605              MOV      r5,r0
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  2d00              CMP      r5,#0
00001e  d038              BEQ      |L24.146|
000020  f8950054          LDRB     r0,[r5,#0x54]
000024  2803              CMP      r0,#3
000026  d134              BNE      |L24.146|
000028  f44f700b          MOV      r0,#0x22c             ;64
00002c  f7fffffe          BL       yaffs_malloc
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  4604              MOV      r4,r0
000032  4627              MOV      r7,r4
000034  b36c              CBZ      r4,|L24.146|
000036  f44f710b          MOV      r1,#0x22c
00003a  4620              MOV      r0,r4
00003c  f7fffffe          BL       __aeabi_memclr4
000040  4816              LDR      r0,|L24.156|
000042  6020              STR      r0,[r4,#0]
000044  f8c45218          STR      r5,[r4,#0x218]
000048  f44f7280          MOV      r2,#0x100
00004c  4631              MOV      r1,r6
00004e  f504708a          ADD      r0,r4,#0x114
000052  f7fffffe          BL       strncpy
000056  bf00              NOP      
000058  f5047009          ADD      r0,r4,#0x224
00005c  f8c40224          STR      r0,[r4,#0x224]
000060  f44f710a          MOV      r1,#0x228
000064  5108              STR      r0,[r1,r4]
000066  bf00              NOP      
000068  480d              LDR      r0,|L24.160|
00006a  6800              LDR      r0,[r0,#0]  ; search_contexts
00006c  b928              CBNZ     r0,|L24.122|
00006e  bf00              NOP      
000070  480b              LDR      r0,|L24.160|
000072  4601              MOV      r1,r0
000074  6008              STR      r0,[r1,#0]  ; search_contexts
000076  6048              STR      r0,[r1,#4]  ; search_contexts
000078  bf00              NOP      
                  |L24.122|
00007a  f5047009          ADD      r0,r4,#0x224
00007e  4908              LDR      r1,|L24.160|
000080  680a              LDR      r2,[r1,#0]
000082  6008              STR      r0,[r1,#0]
000084  6041              STR      r1,[r0,#4]
000086  6002              STR      r2,[r0,#0]
000088  6050              STR      r0,[r2,#4]
00008a  bf00              NOP      
00008c  4620              MOV      r0,r4
00008e  f7fffffe          BL       yaffsfs_SetDirRewound
                  |L24.146|
000092  f7fffffe          BL       yaffsfs_Unlock
000096  4638              MOV      r0,r7
000098  e8bd81f0          POP      {r4-r8,pc}
;;;71     
                          ENDP

                  |L24.156|
                          DCD      0x5941ff53
                  |L24.160|
                          DCD      search_contexts

                          AREA ||area_number.25||, CODE, READONLY, ALIGN=2

                          EXPORTAS ||area_number.25||, ||.text||
                  yaffs_readdir PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4605              MOV      r5,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  462c              MOV      r4,r5
000006  2600              MOVS     r6,#0
000008  f7fffffe          BL       yaffsfs_Lock
00000c  2c00              CMP      r4,#0
00000e  d035              BEQ      |L25.124|
000010  491e              LDR      r1,|L25.140|
000012  6820              LDR      r0,[r4,#0]
000014  4288              CMP      r0,r1
000016  d131              BNE      |L25.124|
000018  2000              MOVS     r0,#0
00001a  f7fffffe          BL       yaffsfs_SetError
;;;67     		yaffsfs_handle[i].obj = NULL;
00001e  f8d4021c          LDR      r0,[r4,#0x21c]
000022  b348              CBZ      r0,|L25.120|
000024  f8d4021c          LDR      r0,[r4,#0x21c]
000028  f7fffffe          BL       yaffs_GetEquivalentObject
00002c  6b00              LDR      r0,[r0,#0x30]         ;64
;;;68     	}
;;;69     	return 0;
00002e  6060              STR      r0,[r4,#4]
;;;70     }
000030  f8d4121c          LDR      r1,[r4,#0x21c]
000034  f8c41110          STR      r1,[r4,#0x110]
000038  f8d41220          LDR      r1,[r4,#0x220]
00003c  1c48              ADDS     r0,r1,#1
00003e  60a1              STR      r1,[r4,#8]
000040  f8c40220          STR      r0,[r4,#0x220]
000044  f44f7280          MOV      r2,#0x100
000048  f104010f          ADD      r1,r4,#0xf
00004c  f8d4021c          LDR      r0,[r4,#0x21c]
000050  f7fffffe          BL       yaffs_GetObjectName
000054  f104000f          ADD      r0,r4,#0xf
000058  f7fffffe          BL       strlen
00005c  b920              CBNZ     r0,|L25.104|
00005e  a10c              ADR      r1,|L25.144|
000060  f104000f          ADD      r0,r4,#0xf
000064  f7fffffe          BL       strcpy
                  |L25.104|
000068  f44f7188          MOV      r1,#0x110
00006c  81a1              STRH     r1,[r4,#0xc]
00006e  1d26              ADDS     r6,r4,#4
000070  4620              MOV      r0,r4
000072  f7fffffe          BL       yaffsfs_DirAdvance
000076  e005              B        |L25.132|
                  |L25.120|
000078  2600              MOVS     r6,#0
00007a  e003              B        |L25.132|
                  |L25.124|
00007c  f06f0008          MVN      r0,#8
000080  f7fffffe          BL       yaffsfs_SetError
                  |L25.132|
000084  f7fffffe          BL       yaffsfs_Unlock
000088  4630              MOV      r0,r6
00008a  bd70              POP      {r4-r6,pc}
;;;71     
                          ENDP

                  |L25.140|
                          DCD      0x5941ff53
                  |L25.144|
000090  7a7a00            DCB      "zz",0
000093  00                DCB      0

                          AREA ||area_number.26||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.26||, ||.text||
                  yaffs_rewinddir PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4625              MOV      r5,r4
000006  f7fffffe          BL       yaffsfs_Lock
00000a  4628              MOV      r0,r5
00000c  f7fffffe          BL       yaffsfs_SetDirRewound
000010  f7fffffe          BL       yaffsfs_Unlock
000014  bd70              POP      {r4-r6,pc}
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.27||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.27||, ||.text||
                  yaffs_closedir PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  b570              PUSH     {r4-r6,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  4604              MOV      r4,r0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4625              MOV      r5,r4
000006  f7fffffe          BL       yaffsfs_Lock
00000a  2000              MOVS     r0,#0
00000c  6028              STR      r0,[r5,#0]
00000e  bf00              NOP      
000010  f8d50224          LDR      r0,[r5,#0x224]
000014  f8d51228          LDR      r1,[r5,#0x228]
000018  6041              STR      r1,[r0,#4]
00001a  6008              STR      r0,[r1,#0]
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  bf00              NOP      
00001e  4628              MOV      r0,r5
000020  f7fffffe          BL       free
000024  f7fffffe          BL       yaffsfs_Unlock
000028  2000              MOVS     r0,#0                 ;64
00002a  bd70              POP      {r4-r6,pc}            ;64
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||area_number.28||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.28||, ||.text||
                  yaffs_symlink PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d43fe          PUSH     {r1-r9,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
000008  2600              MOVS     r6,#0
00000a  f04f38ff          MOV      r8,#0xffffffff
00000e  46b1              MOV      r9,r6
000010  f7fffffe          BL       yaffsfs_Lock
000014  2300              MOVS     r3,#0
000016  aa02              ADD      r2,sp,#8
000018  4629              MOV      r1,r5
00001a  4618              MOV      r0,r3
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  f7fffffe          BL       yaffsfs_FindDirectory
000020  4606              MOV      r6,r0
000022  2000              MOVS     r0,#0
000024  4603              MOV      r3,r0
000026  464a              MOV      r2,r9
000028  e9cd0400          STRD     r0,r4,[sp,#0]         ;64
00002c  4630              MOV      r0,r6                 ;64
;;;68     	}
;;;69     	return 0;
00002e  9902              LDR      r1,[sp,#8]
;;;70     }
000030  f7fffffe          BL       yaffs_MknodSymLink
000034  4607              MOV      r7,r0
000036  b117              CBZ      r7,|L28.62|
000038  f04f0800          MOV      r8,#0
00003c  e005              B        |L28.74|
                  |L28.62|
00003e  f06f001b          MVN      r0,#0x1b
000042  f7fffffe          BL       yaffsfs_SetError
000046  f04f38ff          MOV      r8,#0xffffffff
                  |L28.74|
00004a  f7fffffe          BL       yaffsfs_Unlock
00004e  4640              MOV      r0,r8
000050  e8bd83fe          POP      {r1-r9,pc}
;;;71     
                          ENDP


                          AREA ||area_number.29||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.29||, ||.text||
                  yaffs_readlink PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4607              MOV      r7,r0
000006  4688              MOV      r8,r1
000008  4615              MOV      r5,r2
00000a  2600              MOVS     r6,#0
00000c  f7fffffe          BL       yaffsfs_Lock
000010  2200              MOVS     r2,#0
000012  4639              MOV      r1,r7
000014  4610              MOV      r0,r2
000016  f7fffffe          BL       yaffsfs_FindObject
00001a  4606              MOV      r6,r0
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  b936              CBNZ     r6,|L29.44|
00001e  f06f0001          MVN      r0,#1
000022  f7fffffe          BL       yaffsfs_SetError
000026  f04f34ff          MOV      r4,#0xffffffff
00002a  e017              B        |L29.92|
                  |L29.44|
00002c  f8960054          LDRB     r0,[r6,#0x54]         ;64
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  2802              CMP      r0,#2
000032  d006              BEQ      |L29.66|
000034  f06f0015          MVN      r0,#0x15
000038  f7fffffe          BL       yaffsfs_SetError
00003c  f04f34ff          MOV      r4,#0xffffffff
000040  e00c              B        |L29.92|
                  |L29.66|
000042  f8d69058          LDR      r9,[r6,#0x58]
000046  4629              MOV      r1,r5
000048  4640              MOV      r0,r8
00004a  f7fffffe          BL       __aeabi_memclr
00004e  1e6a              SUBS     r2,r5,#1
000050  4649              MOV      r1,r9
000052  4640              MOV      r0,r8
000054  f7fffffe          BL       strncpy
000058  2400              MOVS     r4,#0
00005a  bf00              NOP      
                  |L29.92|
00005c  f7fffffe          BL       yaffsfs_Unlock
000060  4620              MOV      r0,r4
000062  e8bd87f0          POP      {r4-r10,pc}
;;;71     
                          ENDP


                          AREA ||area_number.30||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.30||, ||.text||
                  yaffs_link PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  e92d4ff8          PUSH     {r3-r11,lr}
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
000008  2500              MOVS     r5,#0
00000a  46a8              MOV      r8,r5
00000c  46a9              MOV      r9,r5
00000e  f7fffffe          BL       yaffsfs_Lock
000012  2200              MOVS     r2,#0
000014  4631              MOV      r1,r6
000016  4610              MOV      r0,r2
000018  f7fffffe          BL       yaffsfs_FindObject
;;;67     		yaffsfs_handle[i].obj = NULL;
00001c  4605              MOV      r5,r0
00001e  2200              MOVS     r2,#0
000020  4639              MOV      r1,r7
000022  4610              MOV      r0,r2
000024  f7fffffe          BL       yaffsfs_FindObject
000028  4680              MOV      r8,r0                 ;64
00002a  b935              CBNZ     r5,|L30.58|
00002c  f06f0001          MVN      r0,#1                 ;64
;;;68     	}
;;;69     	return 0;
;;;70     }
000030  f7fffffe          BL       yaffsfs_SetError
000034  f04f39ff          MOV      r9,#0xffffffff
000038  e03c              B        |L30.180|
                  |L30.58|
00003a  f1b80f00          CMP      r8,#0
00003e  d006              BEQ      |L30.78|
000040  f06f0010          MVN      r0,#0x10
000044  f7fffffe          BL       yaffsfs_SetError
000048  f04f39ff          MOV      r9,#0xffffffff
00004c  e032              B        |L30.180|
                  |L30.78|
00004e  2400              MOVS     r4,#0
000050  46a2              MOV      r10,r4
000052  2300              MOVS     r3,#0
000054  466a              MOV      r2,sp
000056  4639              MOV      r1,r7
000058  4618              MOV      r0,r3
00005a  f7fffffe          BL       yaffsfs_FindDirectory
00005e  4604              MOV      r4,r0
000060  b934              CBNZ     r4,|L30.112|
000062  f06f0013          MVN      r0,#0x13
000066  f7fffffe          BL       yaffsfs_SetError
00006a  f04f39ff          MOV      r9,#0xffffffff
00006e  e009              B        |L30.132|
                  |L30.112|
000070  68a0              LDR      r0,[r4,#8]
000072  68a9              LDR      r1,[r5,#8]
000074  4288              CMP      r0,r1
000076  d005              BEQ      |L30.132|
000078  f06f0011          MVN      r0,#0x11
00007c  f7fffffe          BL       yaffsfs_SetError
000080  f04f39ff          MOV      r9,#0xffffffff
                  |L30.132|
000084  b1ac              CBZ      r4,|L30.178|
000086  9800              LDR      r0,[sp,#0]
000088  f7fffffe          BL       strlen
00008c  b188              CBZ      r0,|L30.178|
00008e  462a              MOV      r2,r5
000090  4620              MOV      r0,r4
000092  9900              LDR      r1,[sp,#0]
000094  f7fffffe          BL       yaffs_Link
000098  4682              MOV      r10,r0
00009a  f1ba0f00          CMP      r10,#0
00009e  d002              BEQ      |L30.166|
0000a0  f04f0900          MOV      r9,#0
0000a4  e005              B        |L30.178|
                  |L30.166|
0000a6  f06f001b          MVN      r0,#0x1b
0000aa  f7fffffe          BL       yaffsfs_SetError
0000ae  f04f39ff          MOV      r9,#0xffffffff
                  |L30.178|
0000b2  bf00              NOP      
                  |L30.180|
0000b4  f7fffffe          BL       yaffsfs_Unlock
0000b8  4648              MOV      r0,r9
0000ba  e8bd8ff8          POP      {r3-r11,pc}
;;;71     
                          ENDP


                          AREA ||area_number.31||, CODE, READONLY, ALIGN=1

                          EXPORTAS ||area_number.31||, ||.text||
                  yaffs_DumpDevStruct PROC
;;;60     //
;;;61     static int yaffsfs_InitHandles(void)
000000  4601              MOV      r1,r0
;;;62     {
;;;63     	int i;
;;;64     	for(i = 0; i < YAFFSFS_N_HANDLES; i++)
000002  2000              MOVS     r0,#0
;;;65     	{
;;;66     		yaffsfs_handle[i].inUse = 0;
000004  4770              BX       lr
;;;67     		yaffsfs_handle[i].obj = NULL;
;;;68     	}
;;;69     	return 0;
;;;70     }
;;;71     
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  yaffsfs_handle
                          %        2400

                          AREA ||.conststring||, DATA, READONLY, MERGE=1, STRINGS, ALIGN=2

000000  2449643a          DCB      "$$Id: yaffsfs.c,v 1.24 2008/11/11 01:47:46 charles Exp "
000004  20796166
000008  66736673
00000c  2e632c76
000010  20312e32
000014  34203230
000018  30382f31
00001c  312f3131
000020  2030313a
000024  34373a34
000028  36206368
00002c  61726c65
000030  73204578
000034  7020    
000036  2400              DCB      "$$",0

                          AREA ||.data||, DATA, ALIGN=2

                  yaffsfs_c_version
                          DCD      ||.conststring||
                  yaffsfs_configurationList
                          DCD      0x00000000
                  yaffs_wr_attempts
                          DCD      0x00000000
                  search_contexts
                          %        8
